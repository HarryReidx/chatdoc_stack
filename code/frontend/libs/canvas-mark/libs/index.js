/**!
 * canvas-mark
 * Version: 1.0.62
 * Author: Intsig Team
 */
const e=()=>{if("undefined"==typeof window||!window?.navigator)return!1;const e=navigator.userAgent;return/Macintosh/.test(e)},t=()=>window.devicePixelRatio||1,n=({nodeName:e="div",className:t,attrs:n,children:o})=>{const r=document.createElement(e);if("string"==typeof t?r.classList.add(t):Array.isArray(t)&&t.map((e=>r.classList.add(e))),n)for(const e in n)r.setAttribute(e,n[e]);return o&&("string"==typeof o?r.innerHTML=o:o.map((e=>r.appendChild(e)))),r},o=e=>"string"==typeof e?document.querySelector(e):e,r=(e,n,o)=>{const r=t();e.width=n*r,e.height=o*r,e.style.width=n+"px",e.style.height=o+"px"},a=e=>new Promise((t=>{requestAnimationFrame((async()=>{await e(),t(void 0)}))})),i=(e,t,n=!1)=>{e.style.cursor&&"default"!==e.style.cursor&&!n||(e.style.cursor=t)},s=e=>e.style?.cursor,l=e=>(e%360+360)%360,c=([e,t],n)=>{const o=n*Math.PI/180,r=Math.cos(o),a=Math.sin(o);return[Math.round(e*r+t*-a),Math.round(e*a+t*r)]},d=(e,t)=>e.length%2?e:((e,t)=>{if(e.length%2)return e;const n=[];for(let o=0;o<e.length;o+=2)n.push(...c([e[o],e[o+1]],t));return n})(e,t=l(t)),g=function(){const e=self,t=async(e,t,n)=>{const o=e,r={src:o,data:e};if(!e)return r;if(e.startsWith("blob:")||e.startsWith("data:"))return n?.callback?.(r),r;e.startsWith("/")&&(e=location.origin+e);const a=await fetch(e,{method:"GET",headers:new Headers(t)}),i={};if(a.headers.forEach(((e,t)=>{i[t]=e})),i["content-type"]?.includes("image"))try{const e=await a.blob();if(n?.base64){const t={src:o,data:await(e=>{const t=new FileReader;return t.readAsDataURL(e),new Promise((e=>{t.onload=t=>{e(t.target.result)}}))})(e),headers:i,type:a.type};return n?.callback?.(t),t}const t={src:o,data:e,headers:i,type:a.type};return n?.callback?.(t),t}catch(e){console.log("download blob error",e)}else try{const e={src:o,data:await a.text(),headers:i,type:a.type};return n?.callback?.(e),e}catch(e){console.log("download content error",e)}return r};e.addEventListener("message",(async n=>{const{data:o}=n;o&&t(o.data.src,o.data.headers,{base64:!0,callback(t){(t=>{e.postMessage(t)})(t)}})}))},p=async(e,t,n)=>{const o=e,r={src:o,data:e};if(!e)return r;if(e.startsWith("blob:")||e.startsWith("data:"))return n?.callback?.(r),r;e.startsWith("/")&&(e=location.origin+e);const a=await fetch(e,{method:"GET",headers:new Headers(t)}),i={};if(a.headers.forEach(((e,t)=>{i[t]=e})),i["content-type"]?.includes("image"))try{const e=await a.blob();if(n?.base64){const t={src:o,data:await(e=>{const t=new FileReader;return t.readAsDataURL(e),new Promise((e=>{t.onload=t=>{e(t.target.result)}}))})(e),headers:i,type:a.type};return n?.callback?.(t),t}const t={src:o,data:e,headers:i,type:a.type};return n?.callback?.(t),t}catch(e){console.log("download blob error",e)}else try{const e={src:o,data:await a.text(),headers:i,type:a.type};return n?.callback?.(e),e}catch(e){console.log("download content error",e)}return r},u=new Map,h_h=new WeakMap,f=(e,t)=>{if(!(u.get(t)instanceof Promise))return u.get(t);const n=new Image;return n.src=e,n.setAttribute("crossOrigin","anonymous"),u.set(t,n),n},m=(e,t,n,o=!0)=>{let r,a=u.get(e);if(a)return a;if("function"==typeof e){const t=e();if(t instanceof Promise){const n=t.then((t=>f(t,e)));return u.set(e,n),n}return f(t,e)}if(o){const o=(e=>{if("undefined"==typeof window)return;if("undefined"==typeof Worker)return;const t=`(${e.toString()})()`,n=new Blob([t],{type:"text/javascript"});return new Worker(window.URL.createObjectURL(n))})(g);o&&(o.onerror=e=>{console.log("worker onerror",e)},r=new Promise((r=>{const a=t=>{const{src:i,data:s}=t.data;if(e===i){const i=f(n?n(t.data):s,e);r(i),o.removeEventListener("message",a)}};o.addEventListener("message",a),o.postMessage({type:"download",data:{id:String(e),src:e,headers:t?.()}})})))}else r=new Promise((async o=>{const r=await p(e,t?.()),{src:a,data:i}=r;if(e===a){o(f(n?n(r):i,e))}}));return u.set(e,r),r},y=async(e,t)=>{const n=e.getContext("2d");if(!n)return;let{src:o,getUrlHeader:r,formatUrl:a,enableWorker:i,left:s,top:c,width:d,height:g,angle:p,border:u,first:f,last:y}=t;const v=async e=>{p??=0;let t=h_h.get(e);t||(t=new Map,h_h.set(e,t)),p=l(p);let o=t?.get(p);o||(0===p?o=e:(o=((e,t)=>{const n=document.createElement("canvas"),o=n.getContext("2d");if(n.width=e.naturalWidth,n.height=e.naturalHeight,null===e||!o)return n;t=l(t);const r=e.width,a=e.height,i=t*Math.PI/180,s=Math.cos(i),c=Math.sin(i),d=Math.abs(s*r+c*a),g=Math.abs(c*r+s*a);switch(n.width=d,n.height=g,o.rotate(i),t){case 0:o.drawImage(e,0,0,r,a);break;case 90:o.drawImage(e,0,-a,r,a);break;case 180:o.drawImage(e,-r,-a,r,a);break;case 270:o.drawImage(e,-r,0,r,a)}return n})(e,p),(()=>{if("undefined"==typeof window||!window?.navigator)return!1;var e=navigator.userAgent,t=/Macintosh|iPhone|iPad|iPod/.test(e),n=/Version\/[\d.]+.*Safari/.test(e)&&!/CriOS/.test(e)&&!/FxiOS/.test(e);return t&&n})()&&(
//!!! safari 不支持 ctx.drawImage(canvas)
o=await(e=>{const t=e.toDataURL("image/png"),n=new Image;return n.src=t,new Promise(((e,t)=>{n.onload=()=>{e(n)},n.onerror=()=>{t(new Error("Failed to load image"))}}))})(o))),t.set(p,o));let r=0,a=0;if(d&&g?(r=d,a=g):d?(r=d,a=d/e.width*e.height):g&&(r=g/e.height*e.width,a=g),n.save(),u){const e=u.lineWidth||1;w(n,{left:s,top:c,width:d,height:g,...u,strokeStyle:u.strokeStyle||"#D76365",lineWidth:e||1,first:f,last:y})}n.drawImage(o,s,c,r,a),n.restore()},x=e=>{if(e)return e.complete?v(e):new Promise((async t=>{e.onload=async()=>{t(await v(e))}}))};let b=m(o,r,a,i);return x(b instanceof Promise?await b:b)},w=(e,n)=>{e.save(),e.beginPath();const o=n.shadow;if(o)for(const t in o)e[t]=o[t];else e.shadowBlur=0;const r=n.lineWidth??1;e.lineWidth=r;const a=t();let i=Math.round(n.left),s=Math.round(n.top),l=Math.round(n.width),c=Math.round(n.height),d=i-r*a/2;i+=d-Math.floor(d);let g=s-r*a/2;if(s+=g-Math.floor(g),n.lineDash&&e.setLineDash(n.lineDash),n.fillStyle&&(e.fillStyle=n.fillStyle,e.fillRect(i,s,l,c)),e.strokeStyle=n.strokeStyle??"green",n.borderPlacement?.length){const[t,o,r,a]=n.padding||[0,0,0,0];for(const d of n.borderPlacement)"left"===d&&(e.moveTo(i-a,s),e.lineTo(i-a,s+c)),"right"===d&&(e.moveTo(i+l+o,s),e.lineTo(i+l+o,s+c)),n.first||"top"!==d||(e.moveTo(i,s-t),e.lineTo(i+l,s-t)),n.last||"bottom"!==d||(e.moveTo(i,s+c+r),e.lineTo(i+l,s+c+r)),e.stroke()}else e.strokeRect(i,s,l,c);e.restore()},v=(e,t)=>{e.save(),e.beginPath();const n=t.position;e.moveTo(n[0],n[1]);for(let t=2;t<n.length;t+=2)e.lineTo(n[t],n[t+1]);e.closePath();const o=t.shadow;if(o)for(const t in o)e[t]=o[t];else e.shadowBlur=0;const r=t.lineWidth??1;e.lineWidth=r,t.position,t.lineDash&&e.setLineDash(t.lineDash),t.fillStyle&&(e.fillStyle=t.fillStyle,e.fill()),e.strokeStyle=t.strokeStyle??"green",e.stroke(),e.restore()},x={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91},b={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32," ":32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h_h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,"numpad 0":96,"numpad 1":97,"numpad 2":98,"numpad 3":99,"numpad 4":100,"numpad 5":101,"numpad 6":102,"numpad 7":103,"numpad 8":104,"numpad 9":105,windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(let e=97;e<123;e++)b[String.fromCharCode(e)]=e-32;for(let e=48;e<58;e++)b[e-48]=e;for(let e=1;e<13;e++)b["f"+e]=e+111;for(let e=0;e<10;e++)b["numpad "+e]=e+96;for(const e in x)b[e]=x[e];const k=Object.freeze({"+":187,"≠":187,"–":189,"ƒ":70,Control:17,Meta:[91,93],ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40}),S=e=>Object.keys(e).reduce(((t,n)=>Object.assign(t,{[n.toLocaleLowerCase()]:e[n]})),{}),P=new Map([[91,"Meta, windows, cmd, ⌘"],[16,"shift, ⇧"],[17,"ctrl, control, ctl, ⌃"],[18,"alt, option, ⌥"]]),M=e=>!!P.get(e),I=e=>e.ctrlKey,C=e=>e.altKey,A=e=>e.shiftKey,R=e=>e.metaKey,O=e=>!(!e.key&&!e.keyCode),T=()=>{const e=new Map,t=new Map,{keycodeMap:n,registerKeycode:o}=(()=>{const e={value:{...b,...x,...S(k)}};return{keycodeMap:e,registerKeycode:t=>{e.value={...e.value,...S(t)}}}})(),r=e=>["keydown","keyup","keypress"].includes(e),a=e=>{const t=[I(e)?[n.value.ctrl]:null,C(e)?[n.value.alt]:null,A(e)?[n.value.shift]:null,R(e)?[n.value.meta]:null];return[...new Set(t.flat(2).filter(Boolean))]},i=e=>{const t=[O(e)?[n.value[e.key.toLocaleLowerCase()]]:null];return[...new Set(t.flat(2).filter(Boolean))]},s=(e,t,n)=>{const o=[...e.keys()],a=r(n.event);return o.every(((n,r)=>{if(!a&&r===o.length-1)return!0;const i=e.get(n);return!!i&&(Array.isArray(i)?t.some((e=>i.includes(e))):t.includes(i))}))},l=(e,t,n)=>function(o){if(!e.shortcut)return void e.callback(o);const r=(e=>[...a(e),...i(e)])(o);if(n?.size||!s(t,r,e)){if(n?.size)if(o instanceof KeyboardEvent){const t=i(o);if("keydown"===o.type){let r=!1;for(const[e,o]of n)r=o,t.some((t=>t===e))&&(n.set(e,!0),r=!0);r&&e.keydown?.(o)}else if("keyup"===o.type){let r=!1;for(const[e,o]of n)r=o,t.some((t=>t===e))&&(n.set(e,!1),r=!1);!r&&e.keyup?.(o)}}else{const r=[...n.keys()];if([...n.values()].filter(Boolean)?.length&&s(t,r,e))return void e.callback(o)}}else e.callback(o)};return{keycodeMap:n,registerKeycode:o,registerEvent:(o="body",a,i)=>{let s;s=a&&i&&"function"==typeof i?{el:o||"body",event:a,callback:i}:o;const c=(t,n,o)=>{const r=(e=>"string"==typeof e?document.querySelector(e):e)(t);if(!r)return;r.addEventListener(n,o);let a=e.get(r);a||(a=[]),a.push({event:n,callback:o}),e.set(r,a)},d=e=>{const t=(e=>{const t=e.shortcut,o=(t||"").split(" + ")?.filter(Boolean)||[],a=r(e.event),i=o.map(((e,r)=>{e=e.toLocaleLowerCase();const i=n.value[e];return i||!a&&r===o.length-1||console.error(`友情提示：'${t}' 中 '${e}' 不存在keyCode编号，需要先调用注册方法 registerKeyMap，例如：{ '${e}': [对应键的keyCode] }。\n          keyCode 参考链接 =>>> https://developer.mozilla.org/zh-CN/docs/Web/API/KeyboardEvent/keyCode#%E9%94%AE%E7%A0%81%E5%80%BC`),[e,i]}));return new Map(i)})(e);if(Array.isArray(e.event))for(const n of e.event)g(e,n,t);else g(e,e.event,t)},g=(e,n,o)=>{const{keycodeMap:a,keyMap:i}=((e,t)=>{const n=new Map,o=new Map;for(const[a,i]of t)if(Array.isArray(i))for(const t of i)null==t||M(t)||r(e)||(n.set(t,!1),o.set(t,a));else null==i||M(i)||r(e)||(n.set(i,!1),o.set(i,a));return{keycodeMap:n,keyMap:o}})(n,o);if(a.size)for(const[t,n]of a){let n={...e};n.shortcut=i.get(t),n.event="keydown";const r=l(n,o,a);e.el&&c(document.body,"keydown",r),n={...e},n.shortcut=i.get(t),n.event="keyup";const s=l(n,o,a);e.el&&c(document.body,"keyup",s)}const s=l(e,o,a);e.el&&c(e.el,n,s),t.set(e.callback,s)};Array.isArray(s)?s.forEach((e=>{d(e)})):d(s)},disabled:{value:!1},destroy:(n,o,r)=>{for(const[a,i]of e.entries())if(!n||n===a)for(const{event:e,callback:n}of i){if(o&&o!==e)continue;const i=r?t.get(r):n;i&&a.removeEventListener(e,i)}e.clear()}}};function B(e,t=[],n=0){n=n||2;var o,r,a,i,s,l,c,d=t&&t.length,g=d?t[0]*n:e.length,p=E(e,0,g,n,!0),u=[];if(!p||p.next===p.prev)return u;if(d&&(p=function(e,t,n,o){var r,a,i,s=[];for(r=0,a=t.length;r<a;r++)(i=E(e,t[r]*o,r<a-1?t[r+1]*o:e.length,o,!1))===i.next&&(i.steiner=!0),s.push(_(i));for(s.sort($),r=0;r<s.length;r++)V(s[r],n),n=D(n,n.next);return n}(e,t,p,n)),e.length>80*n){o=a=e[0],r=i=e[1];for(var h_h=n;h_h<g;h_h+=n)(s=e[h_h])<o&&(o=s),(l=e[h_h+1])<r&&(r=l),s>a&&(a=s),l>i&&(i=l);c=0!==(c=Math.max(a-o,i-r))?1/c:0}return L(p,u,n,o,r,c),u}function E(e,t,n,o,r){var a,i;if(r===oe(e,t,n,o)>0)for(a=t;a<n;a+=o)i=ee(a,e[a],e[a+1],i);else for(a=n-o;a>=t;a-=o)i=ee(a,e[a],e[a+1],i);return i&&U(i,i.next)&&(te(i),i=i.next),i}function D(e,t=!1){if(!e)return e;t||(t=e);var n,o=e;do{if(n=!1,o.steiner||!U(o,o.next)&&0!==H(o.prev,o,o.next))o=o.next;else{if(te(o),(o=t=o.prev)===o.next)break;n=!0}}while(n||o!==t);return t}function L(e,t,n,o,r,a,i=0){if(e){!i&&a&&function(e,t,n,o){var r=e;do{null===r.z&&(r.z=N(r.x,r.y,t,n,o)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,o,r,a,i,s,l,c=1;do{for(n=e,e=null,a=null,i=0;n;){for(i++,o=n,s=0,t=0;t<c&&(s++,o=o.nextZ);t++);for(l=c;s>0||l>0&&o;)0!==s&&(0===l||!o||n.z<=o.z)?(r=n,n=n.nextZ,s--):(r=o,o=o.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=o}a.nextZ=null,c*=2}while(i>1)}(r)}(e,o,r,a);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?W(e,o,r,a):z(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),te(e),e=l.next,c=l.next;else if((e=l)===c){i?1===i?L(e=j(D(e),t,n),t,n,o,r,a,2):2===i&&Z(e,t,n,o,r,a):L(D(e),t,n,o,r,a,1);break}}}function z(e){var t=e.prev,n=e,o=e.next;if(H(t,n,o)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(X(t.x,t.y,n.x,n.y,o.x,o.y,r.x,r.y)&&H(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function W(e,t,n,o){var r=e.prev,a=e,i=e.next;if(H(r,a,i)>=0)return!1;for(var s=r.x<a.x?r.x<i.x?r.x:i.x:a.x<i.x?a.x:i.x,l=r.y<a.y?r.y<i.y?r.y:i.y:a.y<i.y?a.y:i.y,c=r.x>a.x?r.x>i.x?r.x:i.x:a.x>i.x?a.x:i.x,d=r.y>a.y?r.y>i.y?r.y:i.y:a.y>i.y?a.y:i.y,g=N(s,l,t,n,o),p=N(c,d,t,n,o),u=e.prevZ,h_h=e.nextZ;u&&u.z>=g&&h_h&&h_h.z<=p;){if(u!==e.prev&&u!==e.next&&X(r.x,r.y,a.x,a.y,i.x,i.y,u.x,u.y)&&H(u.prev,u,u.next)>=0)return!1;if(u=u.prevZ,h_h!==e.prev&&h_h!==e.next&&X(r.x,r.y,a.x,a.y,i.x,i.y,h_h.x,h_h.y)&&H(h_h.prev,h_h,h_h.next)>=0)return!1;h_h=h_h.nextZ}for(;u&&u.z>=g;){if(u!==e.prev&&u!==e.next&&X(r.x,r.y,a.x,a.y,i.x,i.y,u.x,u.y)&&H(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;h_h&&h_h.z<=p;){if(h_h!==e.prev&&h_h!==e.next&&X(r.x,r.y,a.x,a.y,i.x,i.y,h_h.x,h_h.y)&&H(h_h.prev,h_h,h_h.next)>=0)return!1;h_h=h_h.nextZ}return!0}function j(e,t,n){var o=e;do{var r=o.prev,a=o.next.next;!U(r,a)&&F(r,o,o.next,a)&&J(r,a)&&J(a,r)&&(t.push(r.i/n),t.push(o.i/n),t.push(a.i/n),te(o),te(o.next),o=e=a),o=o.next}while(o!==e);return D(o)}function Z(e,t,n,o,r,a){var i=e;do{for(var s=i.next.next;s!==i.prev;){if(i.i!==s.i&&q(i,s)){var l=Q(i,s);return i=D(i,i.next),l=D(l,l.next),L(i,t,n,o,r,a),void L(l,t,n,o,r,a)}s=s.next}i=i.next}while(i!==e)}function $(e,t){return e.x-t.x}function V(e,t){if(t=function(e,t){var n,o=t,r=e.x,a=e.y,i=-1/0;do{if(a<=o.y&&a>=o.next.y&&o.next.y!==o.y){var s=o.x+(a-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(s<=r&&s>i){if(i=s,s===r){if(a===o.y)return o;if(a===o.next.y)return o.next}n=o.x<o.next.x?o:o.next}}o=o.next}while(o!==t);if(!n)return null;if(r===i)return n;var l,c=n,d=n.x,g=n.y,p=1/0;o=n;do{r>=o.x&&o.x>=d&&r!==o.x&&X(a<g?r:i,a,d,g,a<g?i:r,a,o.x,o.y)&&(l=Math.abs(a-o.y)/(r-o.x),J(o,e)&&(l<p||l===p&&(o.x>n.x||o.x===n.x&&Y(n,o)))&&(n=o,p=l)),o=o.next}while(o!==c);return n}(e,t),t){var n=Q(t,e);D(t,t.next),D(n,n.next)}}function Y(e,t){return H(e.prev,e,t.prev)<0&&H(t.next,e,e.next)<0}function N(e,t,n,o,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-o)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function _(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function X(e,t,n,o,r,a,i,s){return(r-i)*(t-s)-(e-i)*(a-s)>=0&&(e-i)*(o-s)-(n-i)*(t-s)>=0&&(n-i)*(a-s)-(r-i)*(o-s)>=0}function q(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&F(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(J(e,t)&&J(t,e)&&function(e,t){var n=e,o=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(o=!o),n=n.next}while(n!==e);return o}(e,t)&&(H(e.prev,e,t.prev)||H(e,t.prev,t))||U(e,t)&&H(e.prev,e,e.next)>0&&H(t.prev,t,t.next)>0)}function H(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function U(e,t){return e.x===t.x&&e.y===t.y}function F(e,t,n,o){var r=G(H(e,t,n)),a=G(H(e,t,o)),i=G(H(n,o,e)),s=G(H(n,o,t));return r!==a&&i!==s||(!(0!==r||!K(e,n,t))||(!(0!==a||!K(e,o,t))||(!(0!==i||!K(n,e,o))||!(0!==s||!K(n,t,o)))))}function K(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function G(e){return e>0?1:e<0?-1:0}function J(e,t){return H(e.prev,e,e.next)<0?H(e,t,e.next)>=0&&H(e,e.prev,t)>=0:H(e,t,e.prev)<0||H(e,e.next,t)<0}function Q(e,t){var n=new ne(e.i,e.x,e.y),o=new ne(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,o.next=n,n.prev=o,a.next=o,o.prev=a,o}function ee(e,t,n,o){var r=new ne(e,t,n);return o?(r.next=o.next,r.prev=o,o.next.prev=r,o.next=r):(r.prev=r,r.next=r),r}function te(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ne(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function oe(e,t,n,o){for(var r=0,a=t,i=n-o;a<n;a+=o)r+=(e[i]-e[a])*(e[a+1]+e[i+1]),i=a;return r}function re(e,t,n,o){const r=t.copy().sub(e),a=n.copy().sub(t),i=e.copy().sub(n),s=o.copy().sub(e),l=o.copy().sub(t),c=o.copy().sub(n),d=Math.sign(r.cross(s));let g=r.dot(s)/r.length**2;if(0===d&&g>=0&&g<=1)return!0;const p=Math.sign(a.cross(l));if(g=a.dot(s)/a.length**2,0===p&&g>=0&&g<=1)return!0;const u=Math.sign(i.cross(c));return g=i.dot(s)/i.length**2,0===u&&g>=0&&g<=1||d===p&&p===u}B.deviation=function(e,t,n,o){var r=t&&t.length,a=r?t[0]*n:e.length,i=Math.abs(oe(e,0,a,n));if(r)for(var s=0,l=t.length;s<l;s++){var c=t[s]*n,d=s<l-1?t[s+1]*n:e.length;i-=Math.abs(oe(e,c,d,n))}var g=0;for(s=0;s<o.length;s+=3){var p=o[s]*n,u=o[s+1]*n,h_h=o[s+2]*n;g+=Math.abs((e[p]-e[h_h])*(e[u+1]-e[p+1])-(e[p]-e[u])*(e[h_h+1]-e[p+1]))}return 0===i&&0===g?0:Math.abs((g-i)/i)},B.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},o=0,r=0;r<e.length;r++){for(var a=0;a<e[r].length;a++)for(var i=0;i<t;i++)n.vertices.push(e[r][a][i]);r>0&&(o+=e[r-1].length,n.holes.push(o))}return n};class ae extends Array{constructor(e=1,t=0){super(e,t)}set x(e){this[0]=e}set y(e){this[1]=e}get x(){return this[0]}get y(){return this[1]}get length(){return Math.hypot(this.x,this.y)}get dir(){return Math.atan2(this.y,this.x)}copy(){return new ae(this.x,this.y)}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}scale(e){return this.x*=e,this.y*=e,this}cross(e){return this.x*e.y-e.x*this.y}dot(e){return this.x*e.x+e.y*this.y}normalize(){return this.scale(1/this.length)}rotate(e){const t=Math.cos(e),n=Math.sin(e),[o,r]=this;return this.x=o*t+r*-n,this.y=o*n+r*t,this}}const ie=e=>{if(!e?.length||8===e.length)return e;const[t,n,o,r]=e||[],[a,i,s,l]=[t,r,o,n];return[a,i,o,r,s,l,t,n]},se=e=>{const t=e.getContext("2d");if(!t)return[0,0];const n=t.currentTransform||t.getTransform();return[n.e,n.f]},le=e=>{const t=e.getContext("2d");if(!t)return ce();const n=t.currentTransform||t.getTransform();return[n.a,n.d]},ce=()=>{const e=t();return[1*e,1*e]},de=e=>({left:e.left,right:e.left+e.width,top:e.top,bottom:e.top+e.height}),ge=e=>e?.length?(8===e.length&&(e=(e=>e?.length&&4!==e.length?[e[6],e[7],e[2],e[3]]:e)(e)),{left:e[0],top:e[3],width:e[2]-e[0],height:e[1]-e[3]}):{left:0,top:0,width:0,height:0},pe=e=>{const t=e.left,n=e.top,o=e.left+e.width,r=e.top+e.height;return[t,n,o,n,o,r,t,r]},ue=(e,t)=>{const{left:n,right:o,top:r,bottom:a}=fe(e,t),{left:i,width:s,top:l,height:c}=he(e);return o>=i&&n<=s&&a>=l&&r<=c},he=e=>({left:0,top:0,width:e.width,height:e.height}),fe=(e,t)=>{const[n,o]=se(e),[r,a]=le(e),{left:i,top:s,right:l,bottom:c}=t;return{left:i*r+n,top:s*a+o,right:l*r+n,bottom:c*a+o}},me=(e,n)=>{const o=t(),[r,a]=le(e),[i,s]=se(e);return[(n[0]*o-i)/r,(n[1]*o-s)/a]},ye=(e,n)=>{const o=t(),[r,a]=le(e),[i,s]=se(e);return n.map(((e,t)=>1&t?(e*a+s)/o:(e*r+i)/o))},we=e=>e.deltaY,ve=()=>{const e=navigator.userAgent.toLowerCase(),t=t=>t.test(e),n=t=>e?.match(t)?.toString().replace(/[^0-9|_.]/g,"").replace(/_/g,".")||"";let o="unknow";t(/windows|win32|win64|wow32|wow64/g)?o="windows":t(/macintosh|macintel/g)?o="macos":t(/x11/g)?o="linux":t(/android|adr/g)?o="android":t(/ios|iphone|ipad|ipod|iwatch/g)&&(o="ios");let r="unknow";"windows"===o?t(/windows nt 5.0|windows 2000/g)?r="2000":t(/windows nt 5.1|windows xp/g)?r="xp":t(/windows nt 5.2|windows 2003/g)?r="2003":t(/windows nt 6.0|windows vista/g)?r="vista":t(/windows nt 6.1|windows 7/g)?r="7":t(/windows nt 6.2|windows 8/g)?r="8":t(/windows nt 6.3|windows 8.1/g)?r="8.1":t(/windows nt 10.0|windows 10/g)&&(r="10"):"macos"===o?r=n(/os x [\d._]+/g):"android"===o?r=n(/android [\d._]+/g):"ios"===o&&(r=n(/os [\d._]+/g));let a="unknow";"windows"===o||"macos"===o||"linux"===o?a="desktop":("android"===o||"ios"===o||t(/mobile/g))&&(a="mobile");let i="unknow",s="unknow";t(/applewebkit/g)?(i="webkit",t(/edge/g)?s="edge":t(/opr/g)?s="opera":t(/chrome/g)?s="chrome":t(/safari/g)&&(s="safari")):t(/gecko/g)&&t(/firefox/g)?(i="gecko",s="firefox"):t(/presto/g)?(i="presto",s="opera"):t(/trident|compatible|msie/g)&&(i="trident",s="iexplore");let l="unknow";"webkit"===i?l=n(/applewebkit\/[\d._]+/g):"gecko"===i?l=n(/gecko\/[\d._]+/g):"presto"===i?l=n(/presto\/[\d._]+/g):"trident"===i&&(l=n(/trident\/[\d._]+/g));let c="unknow";"chrome"===s?c=n(/chrome\/[\d._]+/g):"safari"===s?c=n(/version\/[\d._]+/g):"firefox"===s?c=n(/firefox\/[\d._]+/g):"opera"===s?c=n(/opr\/[\d._]+/g):"iexplore"===s?c=n(/(msie [\d._]+)|(rv:[\d._]+)/g):"edge"===s&&(c=n(/edge\/[\d._]+/g));let d="none",g="unknow";return t(/micromessenger/g)?(d="wechat",g=n(/micromessenger\/[\d._]+/g)):t(/qqbrowser/g)?(d="qq",g=n(/qqbrowser\/[\d._]+/g)):t(/ucbrowser/g)?(d="uc",g=n(/ucbrowser\/[\d._]+/g)):t(/qihu 360se/g)?d="360":t(/2345explorer/g)?(d="2345",g=n(/2345explorer\/[\d._]+/g)):t(/metasr/g)?d="sougou":t(/lbbrowser/g)?d="liebao":t(/maxthon/g)&&(d="maxthon",g=n(/maxthon\/[\d._]+/g)),Object.assign({engine:i,engineVs:l,platform:a,supporter:s,supporterVs:c,system:o,systemVs:r},"none"===d?{}:{shell:d,shellVs:g})},xe=(e,n)=>{const{onBeforeMove:o,onMove:r,duration:i=50,shortcut:s=""}=n,l=[0,0],c=[0,0],{registerEvent:d,destroy:g}=T(),p="iexplore"==ve().supporter;return d({el:e,event:["wheel"],shortcut:s,callback:async i=>{i.preventDefault();const{top:s,bottom:d,getMin:g,getMax:u}=n,h_h=i,f=t(),m=we(h_h)*f;if(!1===await(o?.(h_h,m)))return;const y=15*(m>0?1:-1);let w=0;const v=(t,n)=>{const o=null!=s||null!=g,r=null!=d||null!=u,[a,i]=le(e);if(o&&m<=0){const e=(s??g?.()??0)*i;n>=e&&(n=e)}else if(r&&m>0){const t=(d??u?.()??0)*i;-n>=t-e.height&&(n=-(t-e.height))}return[t,n]},x=()=>{if(w!==m){if(w+=y,m>0){if(w>m)return;w=Math.min(w,m)}else{if(w<m)return;w=Math.max(w,m)}r?.(h_h,v(l[0],l[1]-y),c),a(x)}};p?r?.(h_h,v(l[0],l[1]-m),c):a(x)}}),{destroy:g,getTranslate:()=>l,updateTranslate:([e,t])=>{c[0]=l[0],c[1]=l[1],l[0]=e,l[1]=t}}},be=({canvas:e,containerSelector:r,onScroll:a,markParams:i,getMarkInstance:s})=>{s();const{registerEvent:l,destroy:c}=T(),d={left:0,top:0,right:0,bottom:0};let g,p;let u,h_h,f=0,m=0,y=0;const w=e=>{f=1},v=(...e)=>{f=1,a(...e),f=0},x=n=>{const o=n.target,r=t();if(n.target===g){const[t,a]=se(e),[s,l]=le(e);if(1===m)return void(m=0);const c=-(d.top-i.margin*l+o?.scrollTop*r);v(n,[t,c])}if(n.target===h_h){const[t,a]=se(e),[s,l]=le(e);if(1===y)return void(y=0);const c=-(d.left-i.margin*s+o?.scrollLeft*r);v(n,[c,a])}},b=()=>{c()};return{init:()=>{const e=o(r);if(!e)return;document.head.appendChild(n({nodeName:"style",children:ke}));const t=e=>Array.isArray(e)?e:[String(e||"")].filter(Boolean),a=t(i.scrollbarVerticalClassName),s=t(i.scrollbarHorizontalClassName);g=n({className:[...a,"mark-scroll-vertical-wrapper"]}),p=n({className:"mark-scroll-vertical"}),g.appendChild(p),e.appendChild(g),h_h=n({className:[...s,"mark-scroll-horizontal-wrapper"]}),u=n({className:"mark-scroll-horizontal"}),h_h.appendChild(u),e.appendChild(h_h),b(),l([{el:g,event:"wheel",callback:w},{el:g,event:"scroll",callback:x},{el:h_h,event:"scroll",callback:x}])},destroy:b,setVerticalScroll:n=>{if(1===f)return;const o=t(),[r,a]=le(e);if(g&&g.scrollHeight>g.clientHeight){const e=Math.max(0,-n[1]-d.top+i.margin*a);m=1,g.scrollTop=e/o}if(h_h&&h_h.scrollWidth>h_h.clientWidth){const e=Math.max(0,-n[0]-d.left+i.margin*r);y=1,h_h.scrollLeft=e/o}},setVerticalRect:(n,o)=>{(e=>{d.left=e.left,d.top=e.top,d.right=e.right,d.bottom=e.bottom})(n);const r=t();if(o?.isLast){const[t,n]=le(e);if(p){const e=d.bottom-d.top;p.style.height=(e+2*i.margin*n)/r+"px"}if(u){const e=d.right-d.left;u.style.width=(e+2*i.margin*t)/r+"px"}}},resetContainerSize:()=>{d.left=0,d.top=0,d.right=0,d.bottom=0}}},ke="\n.mark-scroll-vertical-wrapper {\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n\tpadding: 0;\n\tmargin: 0;\n\twidth: 10px;\n\theight: 100%;\n\toverflow-x: hidden;\n\toverflow-y: auto;\n  z-index: 1;\n}\n.mark-scroll-vertical {\n\twidth: 10px;\n\tmin-height: 100%;\n}\n\n.mark-scroll-horizontal-wrapper {\n\tposition: absolute;\n\tleft: 0;\n\tbottom: 0;\n\tpadding: 0;\n\tmargin: 0;\n\twidth: 100%;\n\theight: 10px;\n\toverflow-x: auto;\n\toverflow-y: hidden;\n  z-index: 1;\n}\n.mark-scroll-horizontal {\n\tmin-width: 100%;\n\theight: 10px;\n}\n\n.mark-scroll-vertical-wrapper::-webkit-scrollbar-thumb:vertical,\n.mark-scroll-vertical-wrapper::-webkit-scrollbar-thumb:horizontal,\n.mark-scroll-horizontal-wrapper::-webkit-scrollbar-thumb:vertical,\n.mark-scroll-horizontal-wrapper::-webkit-scrollbar-thumb:horizontal {\n\tbackground-color: rgb(150, 150, 150);\n}\n\n.mark-scroll-vertical-wrapper::-moz-scrollbar-thumb:vertical,\n.mark-scroll-vertical-wrapper::-moz-scrollbar-thumb:horizontal,\n.mark-scroll-horizontal-wrapper::-moz-scrollbar-thumb:vertical,\n.mark-scroll-horizontal-wrapper::-moz-scrollbar-thumb:horizontal {\n\tbackground-color: rgb(150, 150, 150);\n}\n",Se=(e,n)=>{const{updateTranslate:o,updateScale:r,render:a,getTranslate:s,scrollToolOptions:l,zoomOptions:c,scrollBehaviorY:d,getContainerRect:g,onScroll:p,onDrag:u,onZoom:h_h,markOptions:f,markParams:m}=n;let y=null,w=null,v=null;return{updateTranslate:e=>{y?.updateTranslate(e),w?.updateTranslate(e),v?.updateTranslate(e)},updateScale:e=>{v?.setScale(e)},init:()=>{n.disableScroll||(y=xe(e,{...l,getMin:()=>0,getMax:()=>{const[t,n]=le(e);return g().bottom/n+m.margin},onBeforeMove(n){if(n.altKey)return!1;const[o,r]=se(e);return!(0===r&&!((e,n,o)=>{const[r,a]=le(e);return!(o.bottom-o.top+2*n.margin*a<e.height/t())})(e,m,g()))&&void 0},onMove:(e,t,n)=>{y&&v&&(r(v.getScale()),o(t),a(),p?.(t,n))}})),n.disableMove||(w=((e,n)=>{const{onMove:o,onMoveStart:r,onMoveEnd:a,shortcut:i=""}=n,s={x:0,y:0},l=[0,0],c=[0,0];let d=!1;const{registerEvent:g,destroy:p}=T(),u=e=>0===e.button&&0!==e.buttons;return g({el:e,event:"mousedown",shortcut:i,callback:e=>{d=!0;const n=e,o=t();u(n)&&(s.x=n.x*o,s.y=n.y*o,r?.())},keydown(e){d||r?.()},keyup(e){a?.()}}),g({el:"body",event:"mousemove",shortcut:i,callback:e=>{if(!d)return;const n=t(),r=e;if(u(r)&&(s.x!==r.offsetX||s.y!==r.offsetY)){const e=[l[0],l[1]];l[0]=c[0]+r.x*n-s.x,l[1]=c[1]+r.y*n-s.y,o([l[0],l[1]],e)}}}),g({el:"body",event:"mouseup",shortcut:i,callback:e=>{d&&(c[0]=l[0],c[1]=l[1],d=!1,a?.())}}),{destroy:p,getTranslate:()=>l,updateTranslate:([e,t])=>{d||(l[0]=e,l[1]=t,c[0]=e,c[1]=t)}}})(e,{shortcut:"Space + 鼠标左键",onMoveStart(){i(e,"grab",!0)},onMoveEnd(){i(e,"default",!0)},onMove:(t,n)=>{i(e,"grabbing",!0),w&&v&&(o(w.getTranslate()),r(v.getScale()),a(),u?.(t,n))}})),n.disableZoom||(v=((e,n)=>{const{shortcut:o,step:r=.1,onZoom:a,getMin:i,getMax:s}=n,l=ce(),c=([e,t])=>{l[0]=e,l[1]=t},d={x:0,y:0},g=[0,0],{registerEvent:p,destroy:u}=T(),h_h=(e,n,o,r)=>{const p=t(),[u,h_h]=l;let[f,m]=l;f+=r,m+=r,i&&(f=Math.max(i(),f),m=Math.max(i(),m)),s&&(f=Math.min(s(),f),m=Math.min(s(),m)),d.x=n*p,d.y=o*p,g[0]=d.x-(d.x-g[0])*f/u,g[1]=d.y-(d.y-g[1])*m/h_h,c([f,m]),a(e)};return p({el:e,event:["wheel"],shortcut:o,callback:e=>{e.preventDefault();const t=e,n=we(t);h_h(t,t.offsetX,t.offsetY,n<0?r:-r)}}),{destroy:u,getTranslate:()=>g,updateTranslate:([e,t])=>{g[0]=e,g[1]=t},getScale:()=>l,setScale:c,setScaleAndZoom(e,[t,n]=[0,0]){c(e),h_h(void 0,t,n,0)},setScaleByRadio(e,[t,n]=[0,0]){h_h(void 0,t,n,e)}}})(e,{shortcut:"Alt + 鼠标滚轮",...c||{},onZoom:()=>{v&&(o(v.getTranslate()),r(v.getScale()),a(),h_h?.())}}))},destroy:()=>{y?.destroy(),w?.destroy(),v?.destroy()},setScaleByRadio:(...e)=>v?.setScaleByRadio(...e),setScaleAndZoom:(...e)=>v?.setScaleAndZoom(...e)}},Pe=e=>e.w||e.width||e.page_width,Me=e=>e.h_h||e.height||e.page_height,Ie=(e,t)=>{const n=t.multiple&&e?.bottom||t.margin;return e?n:t.margin},Ce=(e,t,n,o,r,a)=>{let{getLocation:i}=r;const{left:s,width:c}=i(e,r,n);let d=0,g=Pe(e),p=Me(e),u=1;null==g||null==p?(e.aspectRatio&&(u=Number(e.aspectRatio)),d=c/u):(u=c/Pe(e),d=u*Me(e));const h_h=Ie(o,r),f=n?.angle??e.angle??0;if(f){const n=l(f)*Math.PI/180,o=Math.cos(n),i=Math.sin(n),s=Math.abs(o*c+i*d),m=Math.abs(i*c+o*d),y=(r.width-s)/2;return{i:t,item:e,rate:u,angle:f,left:y,top:h_h,right:y+s,bottom:h_h+m+(a?0:r.gap),width:s,height:m,originWidth:g,originHeight:p}}return{i:t,item:e,left:s,top:h_h,right:s+c,bottom:h_h+d+(a?0:r.gap),width:c,height:d,rate:u,angle:f,originWidth:g,originHeight:p}},Ae=(e,t,n,o)=>{if(!e?.length)return e;const r=Ie(n,o),{rate:a,width:i,height:s}=t;let{angle:c=0}=t;return c=l(c),e.map(((e,n)=>{if(1&n){let t=Math.floor(e*a+r);return 90===c?t:180===c||270===c?t+s:t}{let n=Math.floor(e*a+t.left);return 90===c||180===c?n+i:n}}))},Re=(e,t,n)=>{const{margin:o,padding:r,gap:a,width:i,height:s}=t,l=i-2*o-2*r;if([90,270].includes(n?.angle)){const t=Pe(e),n=Me(e);return{left:o,width:Math.min(l,l*t/n)}}return{left:o+r,width:l}},Oe=(e,t,n)=>{const{margin:o,padding:r,gap:a,width:i,height:s,modeOfMaxHeightOptions:l}=t,c=i-2*o-2*r,d=Pe(e),g=Me(e);if(null==d||null==g)return{width:c,left:o};const{scrollTop:p=0,maxWidth:u=c}=l;let h_h=Math.min(u,d/g*(s-o-a-p));if(h_h=Math.max(c/3,h_h),[90,270].includes(n?.angle)){const e=h_h/d*g,t=Math.min(c,e)*d/g;return{left:i/2-t/2,width:t}}return{left:i/2-h_h/2,width:h_h}},Te=(e,t)=>{const{margin:n,width:o,padding:r}=t,a=o-2*n-2*r,i={width:a,left:n};let s,l;const c=Pe(e);if(0===c||null==c)return i;if((Array.isArray(e.areas)&&e.areas.length?e.areas:Array.isArray(e.lines)&&e.lines.length?e.lines:[]).map(((e,t)=>{if(!e)return;let n=e.position||e.pos;n&&(void 0===s&&(s=n[0]),void 0===l&&(l=n[2]),s=Math.min(n[0],n[6],s),l=Math.max(n[2],n[4],l))})),null==s||null==l)return i;const d=a*(c/(l-s));return{left:-(s*(d/c)-n-r),width:d}},Be=(e,{getInternalPage:t,updateShapeState:n})=>{const o=new Map,r=new Map,a=new Map,i=(e,t)=>{a.set(t,e),r.set(e,t)},s=new Map,l=new Map,c=(e,t)=>{let n=s.get(t);n||(n=[]),n.includes(e)||n.push(e),s.set(t,n),l.set(e,t)},d=(e,t)=>{const n=s.get(t);if(n){const t=n.indexOf(e);t>-1&&n.splice(t,1)}},g=e=>{let t=o.get(e.item);return t||(t=(()=>{const e=[];return{getState:()=>e.slice(),setState:t=>{e.includes(t)||(e.push(t),e.sort(((e,t)=>e.options.unshift?-1:t.options.unshift?1:t.options.top-e.options.top)))},removeState:t=>{if(!t)return void(e.length=0);const n=e.findIndex((e=>e===t));~n&&e.splice(n,1)}}})(),o.set(e.item,t)),t},p=(e,t,n={})=>{const{type:o,selector:i}=n;e.getState().forEach((n=>{t&&n!==t||o&&n.options.type!==o||i&&!n.options.selector?.includes(i)||(e.removeState(n),(e=>{let t;(t=a.get(e))&&(r.delete(t),a.delete(e))})(n),(e=>{const t=l.get(e),n=e.options.selector||[];n.includes(t)||n.push(t),n?.forEach((t=>{d(e,t)})),l.has(e)&&l.delete(e)})(n))}))},u=(e,t={})=>{const{type:n,selector:o}=t;e.getState().map((e=>{n&&e.options.type!==n||o&&!e.options.selector?.includes(o)||f(e)}))},h_h=(e,t)=>{e.updateOptions({angle:t.angle??0}),n(e,e.state.index)},f=async e=>{e.isVisible()&&e.render()};return{destroy:()=>{for(const[e,t]of o)t.removeState();o.clear(),r.clear(),s.clear()},getPageState:e=>{if(!e){const e=[];for(const[t,n]of o)e.push(...n.getState()||[]);return e}return(e=t(e))?g(e).getState():[]},setPageState:(e,n)=>{if(!(n=t(n)))return;const o=g(n);let r;if(e.setState({index:n.i}),o.setState(e),i(e.id,e),r=e.options.selector)for(const t of r)c(e,t);e.options.id&&i(e.options.id,e)},renderPageState:(e,t={})=>{if(e){const n=o.get(e.item);n&&u(n,t)}else for(const[e,n]of o)u(n,t)},removePageState:(e,t,n={})=>{if(t){const r=o.get(t.item);r&&p(r,e,n)}else for(const[t,r]of o)p(r,e,n)},updatePageState:e=>{o.get(e.item)?.getState()?.forEach((t=>{h_h(t,e)}))},queryState:e=>{if(null!=e)return r.get(e)||s.get(e)?.[0]},queryAllState:(e,n)=>{if(n){n=t(n);const r=o.get(n.item)?.getState();return null==e?r:r?.filter((t=>t.options.id===e||!!t.options.selector?.includes(e)))}if(null==e)return[...new Set([...r.values()].flat())];let a;return(a=r.get(e))?[a]:s.get(e)?.slice()},addSelector:c,removeSelector:d}},Ee=(e,t)=>({onDrawStart:(...n)=>{t?.onDrawStart?.(...n),e.emit("drawStart",n)},onDrawComplete:(...n)=>{t?.onDrawComplete?.(...n),e.emit("drawComplete",n)},onDrawCancel:(...n)=>{t?.onDrawCancel?.(...n),e.emit("drawCancel",n)},onDrawChange:(...n)=>{t?.onDrawChange?.(...n),e.emit("drawChange",n)},onDrawRemove:(...n)=>{t?.onDrawRemove?.(...n),e.emit("drawRemove",n)}}),De=(e,t)=>({click:(...n)=>{t?.onMarkClick?.(...n),e.emit("markClick",n)},rightClick:(...n)=>{t?.onMarkRightClick?.(...n),e.emit("markRightClick",n)},mousemove:(...n)=>{t?.onMarkHover?.(...n),e.emit("markHover",n)},mouseleave:(...n)=>{t?.onMarkLeave?.(...n),e.emit("markLeave",n)},...Ee(e,t)}),Le={click:"click",rightClick:"mouseup",mousemove:"mousemove",mouseleave:"mousemove"},ze=(e,{markInstance:t,getPageState:n,getPages:o,getPageIndex:r,markOptions:a,getInternalPagesByVisible:l})=>{const{on:c,off:d}=(e=>{const{registerEvent:t,destroy:n}=T();return{on:(n,o)=>{t(e,n,o)},off:n}})(e),g={click:(e,t)=>{t.isInShapeRange(e)&&p?.click?.(t,e)},rightClick:(e,t)=>{2===e.button&&t.isInShapeRange(e)&&p?.rightClick?.(t,e)},mousemove:(e,t)=>{t.isInShapeRange(e)&&(t.setState({inRange:!0}),u(),p?.mousemove?.(t,e))},mouseleave:(e,t)=>{t.state.inRange&&!t.isInShapeRange(e)&&(t.setState({inRange:!1}),p?.mouseleave?.(t,e))}};let p=De(t,a);const u=t=>{s(e)&&"default"!==s(e)||i(e,"pointer",!0)},h_h=(o,r)=>{const c=[];l().forEach((e=>{c.push(...n(e.i))}));let d=!0;for(const e of c)if(e.restorePropagation(),g[r]?.(o,e),e.state.inRange&&(d=!1),!e.state.canEmitEvent)break;d&&(n=>{"pointer"===s(e)&&i(e,"default",!0),a.onMarkNoHover?.(n),t.emit("markNoHover",[n])})(o)};return{init:()=>{p=De(t,a);for(const e in Le)c(Le[e],(t=>h_h(t,e)));c("contextmenu",(e=>e.preventDefault()))},destroy:()=>{d()}}},We=(e,t,n)=>{const{markOptions:o,markInstance:r}=n,a=t.activated;return{events:De(r,o),getOffset(){const n=t.options;return ye(e,[n.left,n.top])},activated(e=!0,n){r.getActive()?.deactivated(),r.setActive(t),a(e,n)},addSelector(e){const n=t.options.selector;t.updateOptions({selector:[...n||[],e]}),r.addSelector(t,e)},removeSelector(e){const n=t.options.selector;t.updateOptions({selector:n?.filter((t=>t!==e))}),r.removeSelector(t,e)},scrollIntoView:e=>{r.scrollIntoView(t.options,e)},destroy:(e=!0)=>{r.removePageState(t),e&&r.render()}}},je=(e,t,n)=>{const o=je.id=je.getId(),r={inRange:!1,index:1,position:[],active:!1,visible:!0,canEmitEvent:!0,data:void 0,angle:0,animationStatus:"done",originOptions:void 0},a=e=>{i.state=Object.freeze({...i.state,...e})},i={id:o,options:Object.freeze(n),updateOptions:e=>{i.options=Object.freeze({...i.options,...e})},state:Object.freeze(r),setState:a,activated:(e=!0,t)=>{a({active:!0}),e&&(i.scrollIntoView(t),i.setActiveAnimation())},deactivated:()=>{a({active:!1})},setActiveAnimation:()=>{},isInShapeRange:e=>!1,isVisible:()=>!1,render:()=>{},destroy:()=>{},scrollIntoView:e=>{},stopPropagation:()=>{i.setState({canEmitEvent:!1})},restorePropagation:()=>{i.setState({canEmitEvent:!0})},addSelector:e=>{},removeSelector:e=>{},getOffset:()=>{},rotate:(e,t)=>{a({angle:e})},move:([e,t])=>{}};return i};je.id=0,je.getId=()=>++je.id;const Ze=(e,t,n)=>{const{left:o,top:r,width:a,height:i}=t,[s,l]=me(e,n);return!(s<o||s>o+a||l<r||l>r+i)},$e=(e,t,n)=>function(e,t){const n=B(e),o=function(e){return e.reduce(((e,t)=>{let n;return(n=e[e.length-1])||(n=[],e.push(n)),n.length<2?n.push(t):e.push([t]),e}),[])}(e),r=new Uint16Array(n);let a=!1;for(let e=0;e<r.length;e+=3)if(re(new ae(...o[r[e]]),new ae(...o[r[e+1]]),new ae(...o[r[e+2]]),new ae(t[0],t[1]))){a=!0;break}return a}(t,me(e,n)),Ve=(e,t,n)=>{const o=je(e,t,n),r=o.updateOptions;o.isInShapeRange=t=>{const n=Array.isArray(t)?t:[t.offsetX,t.offsetY];return $e(e,o.options.position,n)},o.isVisible=()=>ue(e,de(o.options)),o.render=()=>{const{options:e}=o,n=a()*(e._rate||1),r=i(),s=e.text??"",l=`${n}px caption`;let{width:c,height:d}=((e,t,n)=>{n&&(e.save(),e.font=n);const o=e.measureText(t);return n&&e.restore(),{width:o.width,height:Math.abs(o.actualBoundingBoxAscent-o.actualBoundingBoxDescent)}})(t,s,l);const{badge:g,placement:p="left-top"}=e;let u,h_h;switch(t.save(),t.fillStyle=g?.fillStyle||"blue",p){case"left-top":u={left:e.left-(c+2*r),top:e.top-(e?.lineWidth||1)/2,width:c+2*r,height:n+2*r},h_h={left:e.left-(c+r),top:e.top-(e?.lineWidth||1)/2+r};break;case"left-bottom":u={left:e.left-c-2*r,top:e.top+e.height+(e?.lineWidth||1)/2-n-2*r,width:c+2*r,height:n+2*r},h_h={left:e.left-c-r,top:e.top+e.height+(e?.lineWidth||1)/2-n-2*r+r};break;case"right-top":u={left:e.left+e.width,top:e.top-(e?.lineWidth||1)/2,width:c+2*r,height:n+2*r},h_h={left:e.left+e.width+r,top:e.top+r-(e?.lineWidth||1)/2};break;case"right-bottom":u={left:e.left+e.width,top:e.top+e.height+(e?.lineWidth||1)/2-n-2*r,width:c+2*r,height:n+2*r},h_h={left:e.left+e.width+r,top:e.top+e.height+(e?.lineWidth||1)/2-n-2*r+r}}t.fillRect(u.left,u.top,u.width,u.height),t.font=l,t.fillStyle=g?.color||"white",t.textBaseline=g?.textBaseline||"hanging",t.fillText(s,h_h.left,h_h.top),t.restore(),v(t,o.options)};const a=()=>o.options.fontSize??14,i=()=>o.options.padding??2;return o.updateOptions=e=>{r({...o.options,...e})},o.updateOptions(o.options),o},Ye=e=>{let t=e[0],n=e[0],o=e[1],r=e[1];for(let a=2;a<e.length;a++)1&a?(o=Math.min(o,e[a]),r=Math.max(r,e[a])):(t=Math.min(t,e[a]),n=Math.max(n,e[a]));return[t,o,n,o,n,r,t,r]};function Ne(e){return e}const _e=e=>{const{callback:t,duration:n,easing:o=Ne}=e;let r=null,i=0,s=0;const l=()=>{r=null,i=0,s=0},c=async()=>(null==r&&(r=Date.now()),i=Date.now()-r,s=i/n,s=o(s),Number(s.toFixed(5))>=1?(await(t?.(1)),!1):!1!==await(t?.(s))&&void await a(c));return{tick:c,restart:()=>{l(),c()},init:l,destroy:()=>{s=1,l()}}},Xe=e=>{const{keyframes:t,duration:n,render:o,handler:r}=e,{init:i,destroy:s,restore:l,run:c}=r(e),d=()=>{s()};return{run:async()=>{d(),i();for(let e=0;e<t.length-1;e++){const r=t[e],i=t[e+1],{tick:s,destroy:l}=_e({duration:n*(r.percent||0),callback(e){c(r,i,e),o?.()}});await a(s),l()}l(),d()}}},qe=(e,t)=>{let{unit:n,period:o=2}=t||{};const r={...e.options},{width:a,height:i}=ge(Ye(e.options.position));n??=Math.min(a/2,i/2,2)||2;const s=[{position:r.position},{position:Fe(r.position,n)},{position:r.position},{position:Fe(r.position,-n)}];return Array.from({length:o}).map((()=>s)).flat().concat({position:r.position})},He=(e,t,n)=>{const o=qe(e,n);return Xe({duration:600,render:t,keyframes:o.map((t=>({percent:.1,state:[[e,t]]}))),handler:Ue})},Ue=e=>{const{keyframes:t,duration:n,render:o}=e,r=e=>{if("doing"===e.state.animationStatus)return;const t=e.options;e.setState({animationStatus:"doing",originOptions:{position:t.position,...ge(Ye(t.position))}})},a=e=>{if("done"===e.state.animationStatus)return;e.options;const t=e.state.originOptions||{};e.updateOptions({...t}),e.setState({animationStatus:"done",originOptions:void 0})};return{init(){t.map((e=>{for(const[t,n]of e.state)r(t)}))},destroy(){},restore(){t.map((e=>{for(const[t,n]of e.state)a(t)}))},run(e,t,n){for(const[o,r]of e.state){let e=r,a=new Map(t.state).get(o);const i=[],s=e.position,l=a.position;for(let e=0;e<l.length;e++)i[e]=s[e]+(l[e]-s[e])*n;const c=ge(Ye(i));o.updateOptions({position:i,...c})}}}},Fe=(e,t)=>{const[n,o]=(e=>{const t=Math.floor(e.length/2);let n=0,o=0;for(let t=0;t<e.length;t++)1&t?o+=e[t]:n+=e[t];return[n/t,o/t]})(e),r=[];for(let a=0;a<e.length;a++)if(1&a){const n=e[a]<o?-1:1;r[a]=e[a]+t*n}else{const o=e[a]<n?-1:1;r[a]=e[a]+t*o}return r},Ke=(e,t)=>{let{unit:n,period:o=2}=t||{};const r={...e.options};n??=Math.min(r.width/2,r.height/2,2)||2;const a=n,i=n,s=[{left:r.left,top:r.top,width:r.width,height:r.height},{left:r.left-a,top:r.top-i,width:r.width+2*a,height:r.height+2*i},{left:r.left,top:r.top,width:r.width,height:r.height},{left:r.left+a,top:r.top+i,width:r.width-2*a,height:r.height-2*i}];return Array.from({length:o}).map((()=>s)).flat().concat({left:r.left,top:r.top,width:r.width,height:r.height})},Ge=e=>{const{keyframes:t,duration:n,render:o}=e,r=e=>{if("doing"===e.state.animationStatus)return;const t=e.options;e.setState({animationStatus:"doing",originOptions:{left:t.left,top:t.top,width:t.width,height:t.height}})},a=e=>{if("done"===e.state.animationStatus)return;e.options;const t=e.state.originOptions||{};e.updateOptions({...t}),e.setState({animationStatus:"done",originOptions:void 0})};return{init(){t.map((e=>{for(const[t,n]of e.state)r(t)}))},destroy(){},restore(){t.map((e=>{for(const[t,n]of e.state)a(t)}))},run(e,t,n){for(const[o,r]of e.state){let e=r,a=new Map(t.state).get(o);const i=e.left+(a.left-e.left)*n,s=e.top+(a.top-e.top)*n,l=e.width+(a.width-e.width)*n,c=e.height+(a.height-e.height)*n;o.updateOptions({left:i,top:s,width:l,height:c})}}}},Je=(e,t,n,o)=>{const{markInstance:r,markParams:a,setup:i}=o,s=((e,t,n)=>{const o=je(e,t,n);return o.isInShapeRange=t=>{const n=Array.isArray(t)?t:[t.offsetX,t.offsetY];return Ze(e,o.options,n)},o.isVisible=()=>ue(e,de(o.options)),o.render=()=>{o.options.angle&&o.options.angle!==o.state.angle&&o.rotate(o.options.angle,!1),o.state.visible&&w(t,o.options)},o})(e,t,n),l=We(e,s,o);Object.assign(s,{...l,setActiveAnimation:e=>{((e,t,n)=>{const o=Ke(e,n);return Xe({duration:600,render:t,keyframes:o.map((t=>({percent:.1,state:[[e,t]]}))),handler:Ge})})(s,r.render,e).run()},rotate(e,t=!0){const n=s.state.angle;if(n===e)return;s.setState({angle:e});const o=s.state.position,i=r.getInternalPage(s.state.index);if(!i)return;const l=d(o,e-n);if(!l)return;const c=r.getInternalPage(s.state.index-1),g=Ae(l,i,c,a);s.updateOptions({position:g,...ge(Ye(g))}),t&&s.render()},move([e,t]){const n=s.options.position.map(((n,o)=>1&o?n+t:n+e));s.updateOptions({position:n,...ge(Ye(n))}),s.setState({position:r.transformPositionByPagePolygon(n,s.state.index)}),s?.events?.onDrawChange?.(s),r.render()}});return i?.(s),s.options.angle&&s.options.angle!==s.state.angle&&s.rotate(s.options.angle,!1),s};var Qe="object"==typeof global&&global&&global.Object===Object&&global,et="object"==typeof self&&self&&self.Object===Object&&self,tt=Qe||et||Function("return this")(),nt=tt.Symbol,ot=Object.prototype,rt=ot.hasOwnProperty,at=ot.toString,it=nt?nt.toStringTag:void 0;var st=Object.prototype.toString;var lt="[object Null]",ct="[object Undefined]",dt=nt?nt.toStringTag:void 0;function gt(e){return null==e?void 0===e?ct:lt:dt&&dt in Object(e)?function(e){var t=rt.call(e,it),n=e[it];try{e[it]=void 0;var o=!0}catch(e){}var r=at.call(e);return o&&(t?e[it]=n:delete e[it]),r}(e):function(e){return st.call(e)}(e)}function pt(e){return null!=e&&"object"==typeof e}var ut="[object Symbol]";var ht=/\s/;var ft=/^\s+/;function mt(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&ht.test(e.charAt(t)););return t}(e)+1).replace(ft,""):e}function yt(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var wt=NaN,vt=/^[-+]0x[0-9a-f]+$/i,xt=/^0b[01]+$/i,bt=/^0o[0-7]+$/i,kt=parseInt;function St(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||pt(e)&&gt(e)==ut}(e))return wt;if(yt(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=yt(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=mt(e);var n=xt.test(e);return n||bt.test(e)?kt(e.slice(2),n?2:8):vt.test(e)?wt:+e}var Pt=function(){return tt.Date.now()},Mt="Expected a function",It=Math.max,Ct=Math.min;function At(e,t,n){var o,r,a,i,s,l,c=0,d=!1,g=!1,p=!0;if("function"!=typeof e)throw new TypeError(Mt);function u(t){var n=o,a=r;return o=r=void 0,c=t,i=e.apply(a,n)}function h_h(e){var n=e-l;return void 0===l||n>=t||n<0||g&&e-c>=a}function f(){var e=Pt();if(h_h(e))return m(e);s=setTimeout(f,function(e){var n=t-(e-l);return g?Ct(n,a-(e-c)):n}(e))}function m(e){return s=void 0,p&&o?u(e):(o=r=void 0,i)}function y(){var e=Pt(),n=h_h(e);if(o=arguments,r=this,l=e,n){if(void 0===s)return function(e){return c=e,s=setTimeout(f,t),d?u(e):i}(l);if(g)return clearTimeout(s),s=setTimeout(f,t),u(l)}return void 0===s&&(s=setTimeout(f,t)),i}return t=St(t)||0,yt(n)&&(d=!!n.leading,a=(g="maxWait"in n)?It(St(n.maxWait)||0,t):a,p="trailing"in n?!!n.trailing:p),y.cancel=function(){void 0!==s&&clearTimeout(s),c=0,o=l=r=s=void 0},y.flush=function(){return void 0===s?i:m(Pt())},y}function Rt(e,t,n){var o=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return yt(n)&&(o="leading"in n?!!n.leading:o,r="trailing"in n?!!n.trailing:r),At(e,t,{leading:o,maxWait:t,trailing:r})}const Ot=(e,t,n,o)=>{const{markInstance:r,markParams:a,setup:i}=o,s=((e,t,n)=>{const o=je(e,t,n);return o.isInShapeRange=t=>{const n=Array.isArray(t)?t:[t.offsetX,t.offsetY];return $e(e,o.options.position,n)},o.isVisible=()=>ue(e,de(o.options)),o.render=()=>{o.options.angle&&o.options.angle!==o.state.angle&&o.rotate(o.options.angle,!1),o.state.visible&&v(t,o.options)},o})(e,t,n),l=We(e,s,o);Object.assign(s,{...l,setActiveAnimation:e=>{He(s,r.render,e).run()},rotate(e,t=!0){const n=s.state.angle;if(n===e)return;s.setState({angle:e});const o=s.state.position,i=r.getInternalPage(s.state.index);if(!i)return;const l=d(o,e-n);if(!l)return;const c=r.getInternalPage(s.state.index-1),g=Ae(l,i,c,a);s.updateOptions({position:g,...ge(Ye(g))}),t&&s.render()},move([e,t]){const n=s.options.position.map(((n,o)=>1&o?n+t:n+e));s.updateOptions({position:n,...ge(Ye(n))}),s.setState({position:r.transformPositionByPagePolygon(n,s.state.index)}),s?.events?.onDrawChange?.(s),r.render()}});return i?.(s),s.options.angle&&s.options.angle!==s.state.angle&&s.rotate(s.options.angle,!1),s},Tt=(e,t,n,o)=>{const{markInstance:r,markParams:a,setup:i}=o,s=((e,t,n)=>{const o=je(e,t,n);return o.isInShapeRange=t=>{const n=Array.isArray(t)?t:[t.offsetX,t.offsetY];return Ze(e,o.options,n)},o.isVisible=()=>ue(e,de(o.options)),Object.assign(o,{render:async()=>{await y(e,o.options)},options:n})})(e,t,n),l=We(e,s,o);Object.assign(s,{...l});return i?.(s),s},Bt=(e,t,n)=>{const{markParams:o,markOptions:r,markInstance:a,getInternalPageByIndex:i,getInternalPage:s,changePage:l,render:c,scrollToMark:g,setPageState:p,removePageState:u,removeSelector:h_h,addSelector:f,queryState:y,queryAllState:w,getPageIndex:v,getPages:x,setActive:b,getActive:k}=n,S=new Map,P=e=>{const t=s(e);t&&m(t.item.getUrl||t.item.url,t.item.getUrlHeader,t.item.formatUrl,r.enableWorker)},M=()=>{const e=v();((e,...t)=>{let n=null;const o=r=>{requestIdleCallback((async a=>{if(n&&(clearTimeout(n),n=null),a.timeRemaining()>0||a.didTimeout){const n=await e(...t);r(n)}else n=setTimeout((()=>{o(r)}),30)}))};new Promise((e=>o(e)))})((()=>{(e=>{const t=o.preloadImageNum,n=x().length,r=Math.max(1,e-t),a=Math.min(n,e+t);let i=e-1,s=e+1;for(;i>r||s<a;)i>0&&P(i),s<=n&&P(s),i--,s++})(e)}))},I=(e,t,n)=>{if(!t?.position?.length)return;const o=i(t.index||v());let s;if(o){if(s=e(t.position,o.i,t.options),!s)return;null!=n?.visible&&s.setState({visible:n.visible}),s.setState({data:t?.data}),(e=>{if(!e.isVisible())return e;e.render(),r.onDrawComplete?.(e),a.emit("drawComplete",[e])})(s)}return s},C=(n,s,l)=>{const c=i(s);if(!c)return;const d=i(c.i-1),g=Ae(n,c,d,o),u={position:g,...ge(g),type:"rect",strokeStyle:"#1a66ff",fillStyle:"rgba(72, 119, 255, 0.1)",angle:c.angle,...l,_rate:c.rate},h_h=Je(e,t,u,{markParams:o,markOptions:r,markInstance:a,setup(e){e.setState({position:n,index:s})}});return p(h_h,c),h_h},A=(n,s,l)=>{const c=i(s);if(!c)return;const d=i(c.i-1),g=Ae(n,c,d,o),u={type:"polygon",position:g,...ge(g),strokeStyle:"#1a66ff",fillStyle:"rgba(72, 119, 255, 0.1)",angle:c.angle,...l,_rate:c.rate},h_h=Ot(e,t,u,{markParams:o,markOptions:r,markInstance:a,setup(e){e.setState({position:n,index:s})}});return p(h_h,c),h_h},R=(n,s,l)=>{const c=i(s);if(!c)return;const g=i(c.i-1),u=Ae(n,c,g,o),h_h={type:"badge",position:u,...ge(u),strokeStyle:"#1a66ff",fillStyle:"rgba(72, 119, 255, 0.1)",angle:c.angle,...l,_rate:c.rate},f=((e,t,n,o)=>{const{markInstance:r,markParams:a,setup:i}=o,s=Ve(e,t,n),l=We(e,s,o);return Object.assign(s,{...l,setActiveAnimation:e=>{He(s,r.render,e).run()},rotate(e,t=!0){const n=s.state.angle;if(n===e)return;s.setState({angle:e});const o=s.state.position,i=r.getInternalPage(s.state.index);if(!i)return;const l=d(o,e-n);if(!l)return;const c=r.getInternalPage(s.state.index-1),g=Ae(l,i,c,a);s.updateOptions({position:g,...ge(Ye(g))}),t&&s.render()},move([e,t]){const n=s.options.position.map(((n,o)=>1&o?n+t:n+e));s.updateOptions({position:n,...ge(Ye(n))}),s.setState({position:r.transformPositionByPagePolygon(n,s.state.index)}),s?.events?.onDrawChange?.(s),r.render()}}),i?.(s),s.options.angle&&s.options.angle!==s.state.angle&&s.rotate(s.options.angle,!1),s})(e,t,h_h,{markParams:o,markOptions:r,markInstance:a,setup(e){e.setState({position:n,index:s})}});return p(f,c),f},O=(e,t=v())=>{const n=i(t);if(!n)return;return((e,t,n,o)=>{if(!e?.length)return e;const r=Ie(n,o),a=t.rate;return e.map(((e,n)=>1&n?Math.floor((e-r)/a):Math.floor((e-t.left)/a)))})(e,n,i(n.i-1),o)};return{destroy:()=>{S.clear()},drawInternalPageBgImage:async n=>{const i={src:n.item.getUrl||n.item.url,getUrlHeader:n.item.getUrlHeader,formatUrl:n.item.formatUrl,enableWorker:r.enableWorker,type:"image",border:o.backgroundImageBorder,...n,angle:(n.item.imageAngle||0)+n.angle,id:`bg-image-${String(n.i)}`,selector:[".bg-image"],unshift:!0,first:1===n.i,last:n.i===x().length};let s=S.get(i.id);s||(s=Tt(e,t,i,{markOptions:r,markParams:o,markInstance:a}),S.set(i.id,s),p(s,n)),await s.render(),M()},removeShape:e=>{var t;"number"==typeof(t=e)||pt(t)&&"[object Number]"==gt(t)?u(void 0,i(e)):u(void 0,void 0,e)},drawBadge:(e,t)=>I(R,e,t),drawRect:(e,t)=>I(C,e,t),drawPolygon:(e,t)=>I(A,e,t),createExternalRectState:C,updateShapeState:(e,t)=>{const n=i(t);if(!n)return;const r=e.state.position;if(!r)return;const a=i(n.i-1);if("polygon"===e.options.type||"badge"===e.options.type){const t=e,i=Ae(r,n,a,o),s=ge(i),l={...t.options,position:i,...s,_rate:n.rate};t.updateOptions(l),t.options.angle&&(t.setState({angle:0}),t.rotate(t.options.angle,!1))}else{const t=e,i=ge(Ae(r,n,a,o)),s={...t.options,...i};t.updateOptions(s),t.options.angle&&(t.setState({angle:0}),t.rotate(t.options.angle,!1))}return e},transformPositionByPageRect:(e,t=v())=>O(pe(e),t),transformPositionByPagePolygon:O,removePageBgImageState:()=>{[...S.values()].forEach((e=>{e.destroy(!1)})),S.clear()}}},Et=(e,t,n)=>{let o=1;const r=()=>o,a=()=>s.pages||[],i=e=>a()[e-1],{markParams:s,markOptions:l,markInstance:c,updateContainerRect:d,resetContainerRect:g,updateTranslate:p,getLastScale:u,render:h_h,scrollIntoView:f,scrollBehaviorY:m}=n,y=new WeakMap,w=(e=r())=>("number"==typeof e&&(e=v(e)),e),v=e=>(e=>y.get(e))(i(e)),x=t=>{((e,t)=>{const{top:n,bottom:o}=fe(e,t),{top:r,height:a}=he(e),i=(a-r)/2;return o>=i&&n<=i})(e,t)&&k(t)},b=()=>Q,k=(e,t=!0)=>{(e=w(e))&&o!==e.i&&(o=e.i,t&&(l.onChangePage?.(o,e.item),c.emit("changePage",[o,e.item])))},S=(e,t=!0,n=!0)=>{k(e,n),t&&P(e),h_h(!0)},P=t=>{const[n]=se(e),[o,r]=le(e);t=w(t);const a=s.multiple?1===t.i?s.margin:s.gap:s.margin;p([n,-t.top*r+a])},{setActive:M,getActive:I}=(()=>{let e=null;return{getActive:()=>e,setActive:t=>{e=t}}})(),{destroy:C,getPageState:A,setPageState:R,removePageState:O,renderPageState:T,updatePageState:B,queryState:E,queryAllState:D,removeSelector:L,addSelector:z}=Be(0,{getInternalPage:w,updateShapeState:(...e)=>N(...e)}),{destroy:W,drawRect:j,drawPolygon:Z,drawBadge:$,removeShape:V,drawInternalPageBgImage:Y,updateShapeState:N,removePageBgImageState:_,transformPositionByPageRect:X,transformPositionByPagePolygon:q}=Bt(e,t,{markOptions:l,markParams:s,markInstance:c,getInternalPageByIndex:v,getInternalPage:w,changePage:S,scrollToMark:f,getPageIndex:r,getPages:a,render:h_h,setPageState:R,removePageState:O,queryState:E,queryAllState:D,setActive:M,getActive:I,removeSelector:L,addSelector:z}),{init:H,destroy:U}=ze(e,{markInstance:c,markOptions:l,getPageIndex:r,getPageState:A,getPages:a,getInternalPagesByVisible:b}),F=()=>{let e;_(),g();const t=a();for(let n=0;n<t.length;n++){const o=i(n+1),r=y.get(o),a=n===t.length-1,l=Ce(o,n+1,r,e,s,a);y.set(o,l),e=l,d(l,a),B(l)}},K=e=>{G[e.i]?(Y(e),T(e)):(l.onImageLoading?.(e.i,e.item),c.emit("imageLoading",[e.i,e.item]),Y(e).then((()=>{l.onImageLoaded?.(e.i,e.item),c.emit("imageLoaded",[e.i,e.item]),G[e.i]||(l.onFirstRendered?.(e.i,e.item),c.emit("firstRendered",[e.i,e.item])),G[e.i]=!0,T(e)})))},G=[],J=async()=>{Q.length=0;(t=>{const n=a(),{top:o,height:r}=he(e),s=new Map,l=t=>{if(s.get(t))return;const a=i(t+1),c=y.get(a),{top:d,bottom:g}=fe(e,c);g>=o&&d<=r&&(s.set(t,!0),Q.push(c),Q.sort(((e,t)=>e.i-t.i)),t>0&&l(t-1),t<n.length-1&&l(t+1))};l(t)})((()=>{let t=0,n=a().length,o=0;const{top:r,height:s}=he(e);let l=0;for(;t<n;){o=~~((t+n)/2);const a=i(o+1),c=y.get(a),{top:d,bottom:g}=fe(e,c);if(d>s)n=o;else if(g<r)t=o;else if(g>=r&&d<=s)break;if(3e4==++l){console.log("Infinite loop...");break}}return o})());const t=Q;for(let e=0;e<t.length;e++){const n=t[e];x(n),K(n)}},Q=[];return{init:()=>{o=1,F(),U(),H()},update:()=>{F(),c.emit("update",a())},destroy:()=>{G.length=0,W(),C(),U()},getPageIndex:r,getPagesByVisible:()=>Q.map((e=>e.item)),getPageByPoint:([e,t])=>{if(t<0)return 1;const n=t,o=a();for(const e of o){const t=y.get(e);if(t&&t.top>n)return Math.max(1,t.i-1)}return o.length},changePage:S,drawPage:async(e=!1)=>{s.multiple?J():(async()=>{Q.length=0;const e=i(o),t=y.get(e);g(),d(t,!0),Q.push(t),K(t)})()},drawRect:j,drawPolygon:Z,drawBadge:$,removeRect:V,removeShape:V,getInternalPage:w,getInternalPagesByVisible:b,genInternalPages:F,scrollToMark:f,scrollIntoView:f,removePageState:O,updatePageState:B,getPageState:A,setPageState:R,transformPositionByPageRect:X,transformPositionByPagePolygon:q,queryState:E,queryAllState:D,setActive:M,getActive:I,addSelector:z,removeSelector:L}};function Dt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Lt=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,n=[],o=0;o<e.rangeCount;o++)n.push(e.getRangeAt(o));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||n.forEach((function(t){e.addRange(t)})),t&&t.focus()}},zt={"text/plain":"Text","text/html":"Url",default:"Text"};var Wt=function(e,t){var n,o,r,a,i,s,l=!1;t||(t={}),n=t.debug||!1;try{if(r=Lt(),a=document.createRange(),i=document.getSelection(),(s=document.createElement("span")).textContent=e,s.ariaHidden="true",s.style.all="unset",s.style.position="fixed",s.style.top=0,s.style.clip="rect(0, 0, 0, 0)",s.style.whiteSpace="pre",s.style.webkitUserSelect="text",s.style.MozUserSelect="text",s.style.msUserSelect="text",s.style.userSelect="text",s.addEventListener("copy",(function(o){if(o.stopPropagation(),t.format)if(o.preventDefault(),void 0===o.clipboardData){n&&console.warn("unable to use e.clipboardData"),n&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var r=zt[t.format]||zt.default;window.clipboardData.setData(r,e)}else o.clipboardData.clearData(),o.clipboardData.setData(t.format,e);t.onCopy&&(o.preventDefault(),t.onCopy(o.clipboardData))})),document.body.appendChild(s),a.selectNodeContents(s),i.addRange(a),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");l=!0}catch(r){n&&console.error("unable to copy using execCommand: ",r),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),l=!0}catch(r){n&&console.error("unable to copy using clipboardData: ",r),n&&console.error("falling back to prompt"),o=function(e){var t=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}("message"in t?t.message:"Copy to clipboard: #{key}, Enter"),window.prompt(o,e)}}finally{i&&("function"==typeof i.removeRange?i.removeRange(a):i.removeAllRanges()),s&&document.body.removeChild(s),r()}return l},jt=Dt(Wt);const Zt=t=>{const{canvas:n,markInstance:o,markParams:r,markOptions:a}=t;let i=!1,s=!1;const l=[0,0],c=[0,0],d=[0,0],g=new Map,p=new Map,u=new Map,h_h=e=>{if(0!==e.button)return;const t=e;if(t.altKey||t.ctrlKey||t.metaKey)return;i=!0,[l[0],l[1]]=me(n,[t.x,t.y]),[c[0],c[1]]=me(n,[t.offsetX,t.offsetY]),s=!1,$t(u);const r=o.getPageByPoint(c);o.getInternalPage(r),g.clear()},f={value:null},m=()=>{f.value&&(clearInterval(f.value),f.value=null)},y=e=>{if(!i)return;const t=e;[d[0],d[1]]=me(n,[t.x,t.y]);const h_h=d[0]-l[0]>0?1:-1,f=d[1]-l[1]>0?1:-1,m=(()=>{const e=d[0]-l[0],t=d[1]-l[1],n={left:c[0],top:c[1],width:e,height:t};return e<0&&(n.left=c[0]+e,n.width=-e),t<0&&(n.top=c[1]+t,n.height=-t),n})(),y=[...c,c[0]+d[0]-l[0],c[1]+d[1]-l[1]],w=o.getPageByPoint([y[0],y[1]]),v=o.getPageByPoint([y[2],y[3]]);if(null==w||null==v)return;const x=e=>{const t=o.getInternalPage(e)?.angle||0,n=g.get(e);n&&(n.length=0);const i={angle:t,markInstance:o,markParams:r,page:e,pageItem:(a.pages||[])[e-1],directionX:h_h,directionY:f,selectRect:m,pageLineCollection:g,pageRotateCharPosCollection:p};Yt(i),Vt({page:e,pageLineCollection:g,pageShapeCollection:u,markInstance:o}),s=!0};let b=v;if(f>0)for(;b>=Math.max(w,v-1);)x(b),b--;else for(;b<=Math.min(w,v+1);)x(b),b++;o.render()},w=e=>{const t=o.getTranslate();t[1]+=e,o.updateTranslate(t)},v=Rt((e=>{m(),y(e);const t=n.getBoundingClientRect();if(e.x>t.left&&e.x<t.right&&t.bottom-e.y<20){const n=Math.max(4,t.bottom-e.y);f.value=setInterval((()=>{i?(w(-5),y({x:e.x,y:e.y+.01})):m()}),n)}else if(e.x>t.left&&e.x<t.right&&e.y-t.top<20){const n=Math.max(4,e.y-t.top);f.value=setInterval((()=>{i?(w(5),y({x:e.x,y:e.y+.01})):m()}),n)}}),30,{leading:!0,trailing:!0}),x=e=>{m(),i&&(i=!1,a.onCopySelected?.(e,g))},b=()=>{s=!1,$t(u)},{registerEvent:k,destroy:S}=T();return{name:"CopyTextPlugin",init:()=>{k({el:document.body,event:"keydown",shortcut:e()?"Command + C":"Ctrl + C",callback:()=>{a.onCopySelected?a.onCopySelected(null,g):(()=>{const e=[...g.values()].flat().map((e=>e.text)).join("\r\n");jt(e||"",{debug:!1})})()}}),document.body.addEventListener("mousedown",b),n.addEventListener("mousedown",h_h),window.addEventListener("mousemove",v),window.addEventListener("mouseup",x)},destroy:()=>{S(),document.body.removeEventListener("mousedown",b),n.removeEventListener("mousedown",h_h),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",x),m(),p.clear(),g.clear(),u.clear()},isDrag:()=>i,hasMark:()=>s}},$t=(e,t)=>{for(const[n,o]of e)t&&t!==n||([...o.values()].forEach((e=>e.destroy())),o.clear());null==t&&e.clear()},Vt=e=>{const{page:t,pageLineCollection:n,pageShapeCollection:o,markInstance:r}=e,a=new Map,i=o.get(t);n.get(t)?.map((e=>{(e=>{const t=[];let n=ie(e[0]);for(let a=1;a<e.length;a++){const i=ie(e[a]);n[7]<i[1]?(t.push(n),n=i):(o=n,r=i,n=[Math.min(o[0],r[0]),Math.min(o[1],r[1]),Math.max(o[2],r[2]),Math.min(o[3],r[3]),Math.max(o[4],r[4]),Math.max(o[5],r[5]),Math.min(o[6],r[6]),Math.max(o[7],r[7])])}var o,r;return t.push(n),t})(e.pos).map((e=>{const n=e.join(",");let o=i?.get(n)||a?.get(n);if(o)return i?.delete(n),void a.set(n,o);o=r.drawRect({index:t,position:e,options:{strokeStyle:"transparent",fillStyle:"rgb(26, 102, 255, 0.3)",selector:["copy-block-mark"]}}),o&&a.set(n,o)}))})),i&&([...i.values()].forEach((e=>e.destroy())),i.clear()),o.set(t,a)},Yt=e=>{const{angle:t,page:n,pageItem:o,selectRect:r,directionX:a,directionY:i,pageLineCollection:s,markInstance:l,markParams:c,pageRotateCharPosCollection:d}=e,g=o.lines||[];let p=l.transformPositionByPageRect(r,n);if(!p)return;for(let e=0;e<p.length;e++)p[e]<0&&(p[e]=0);const u=ge(p),h_h=a>0?u.left:u.left+u.width,f=i>0?u.top:u.top+u.height,m=a>0?u.left+u.width:u.left,y=i>0?u.top+u.height:u.top;for(let e=0;e<g.length;e++){if(!g[e].text)continue;const r={angle:t,page:n,pageItem:o,line:g[e],directionX:a,directionY:i,startX:h_h,startY:f,endX:m,endY:y,pageLineCollection:s,pageRotateCharPosCollection:d,markInstance:l};Ut(r)}},Nt=e=>{const{position:t,page:n,angle:o,markInstance:r}=e,a=r.getInternalPage(n);if(!a)return t;const i=((e,t,n,o)=>{if(e.length%2)return e;t=l(t);let r=[];const a=(e,r)=>1&e?90===t?r:180===t?r+o:270===t?r+n:r:90===t?r+o:180===t?r+n:r;for(let n=0;n<e.length;n+=2){let[o,i]=c([e[n],e[n+1]],t);r.push(a(n,o),a(n+1,i))}const i=(e,t,n)=>{let o=e[t];e[t]=e[n],e[n]=o};return 180===t?(i(r,0,4),i(r,1,5),i(r,2,6),i(r,3,7)):90===t?(i(r,0,4),i(r,3,7)):270===t&&(i(r,1,5),i(r,2,6)),r})(t,o,a.originWidth||0,a.originHeight||0);return i||t},_t=new Map,Xt=e=>e.char_positions||e.char_pos||[],qt=(e,t)=>Xt(e)?.[t]||[],Ht=e=>e.position||e.pos||[],Ut=e=>{const{line:t,page:n,pageItem:o,angle:r=0,directionX:a,directionY:i,startX:s,startY:l,endX:c,endY:d,pageLineCollection:g,markInstance:p,pageRotateCharPosCollection:u}=e;if(!Ht(t)?.length)return;const h_h=e=>{let t=u.get(n);t||u.set(n,t=new Map);let o=e.join(","),a=t.get(o);return a||t.set(o,a=[]),a[r]||(a[r]=Nt({position:e,page:n,markInstance:p,angle:r})),a[r]},f=h_h(Ht(t)),m=ge(f);if(!Qt(r,a,i,s,l,c,d,m))return;let y=Jt(r,a,i,s,l,c,d,m);const w={index:n,text:"",pos:[],areaIndex:-1},v=(e,t,n,o)=>{w.areaIndex=((e,t)=>{if(null==t.id)return;const n=`${e.index}_${t.id}`,o=_t.get(n);if(o)return o;const r=t.id,a=(e,t,n)=>{if("number"==typeof t)return t===e;if(Array.isArray(t)&&t.length){if("number"==typeof t[0])return t.includes(e);if("object"==typeof t[0])return t.some((t=>a(e,t.content,t.blocks)))}else if(Array.isArray(n)&&n.length)return n.some((t=>a(e,t.content)))},i=e.areas.findIndex((e=>!!e&&("table"===e.type?!!e.cells?.some((e=>a(r,e.content,e.blocks))):a(r,e.content,e.blocks))));return _t.set(n,i),i})(n,o);n.areas[w.areaIndex];w.pos.push(t),w.text+=e},x=(e=>(e.char_positions||e.char_pos||[])?.length>0)(t),b=x?Xt(t):[Ht(t)];for(let e=0;e<b.length;e++){const n=x?qt(t,e):b[e],g=x?t.text[e]:t.text;Ft({pageItem:o,lineItem:t,angle:r,directionX:a,directionY:i,startX:s,startY:l,endX:c,endY:d,isMatchFirstLine:y,lineRect:m,text:g,charPos:n,collectText:v,transformPos:h_h})}if(w.pos.length){let e=g.get(n);e||g.set(n,e=[]),e.push(w)}},Ft=e=>tn(e.angle)?Kt(e):Gt(e),Kt=e=>{const{pageItem:t,lineItem:n,collectText:o,angle:r=0,directionX:a,directionY:i,startX:s,startY:l,endX:c,endY:d,isMatchFirstLine:g,lineRect:p,text:u,charPos:h_h,transformPos:f}=e,m=ge(f(h_h));if(g)return l<m.top+m.height&&d>m.top?(o(u,h_h,t,n),!0):!(l>m.top&&d<m.top+m.height)||(o(u,h_h,t,n),!0);if(a>0){if(c>p.left+p.width&&l>m.top)return o(u,h_h,t,n),!0;if(s<p.left&&c>p.left+p.width)return o(u,h_h,t,n),!0;if(c>p.left&&c<p.left+p.width&&d<m.top+m.height)return o(u,h_h,t,n),!0}else{if(c<p.left&&l<m.top+m.height)return o(u,h_h,t,n),!0;if(s>p.left+p.width&&c<p.left)return o(u,h_h,t,n),!0;if(c>p.left&&c<p.left+p.width&&d>m.top)return o(u,h_h,t,n),!0}},Gt=e=>{const{pageItem:t,lineItem:n,collectText:o,angle:r=0,directionX:a,directionY:i,startX:s,startY:l,endX:c,endY:d,isMatchFirstLine:g,lineRect:p,text:u,charPos:h_h,transformPos:f}=e,m=ge(f(h_h));if(g)return s<m.left+m.width&&c>m.left?(o(u,h_h,t,n),!0):!(s>m.left&&c<m.left+m.width)||(o(u,h_h,t,n),!0);if(i>0){if(d>p.top+p.height&&s<m.left+m.width)return o(u,h_h,t,n),!0;if(l<p.top&&d>p.top+p.height)return o(u,h_h,t,n),!0;if(d>p.top&&d<p.top+p.height&&c>m.left)return o(u,h_h,t,n),!0}else{if(d<p.top&&s>m.left)return o(u,h_h,t,n),!0;if(l>p.top+p.height&&d<p.top)return o(u,h_h,t,n),!0;if(d>p.top&&d<p.top+p.height&&c<m.left+m.width)return o(u,h_h,t,n),!0}},Jt=(e,t,n,o,r,a,i,s)=>{if(en(e)){if(r>s.top&&r<s.top+s.height&&i>s.top&&i<s.top+s.height)return!0}else if(tn(e)&&o>s.left&&o<s.left+s.width&&a>s.left&&a<s.left+s.width)return!0;return!1},Qt=(e,t,n,o,r,a,i,s)=>{if(en(e)){if(n>0){if(r>s.top+s.height||i<s.top)return!1}else if(r<s.top||i>s.top+s.height)return!1}else if(tn(e))if(t<0){if(o<s.left||a>s.left+s.width)return!1}else if(o>s.left+s.width||a<s.left)return!1;return!0};function en(e){return[0,180].includes(e)}function tn(e){return[90,270].includes(e)}const nn=e=>{const{point:t,markInstance:n}=e,o=n.getInternalPagesByVisible()||[];let r;for(const e of o){const o=n.queryAllState(void 0,e);if(r=o?.find((e=>e.state.visible&&e.isInShapeRange(t))),r)break}return r},on=e=>{const t={draw:!1,drag:!1,canDrawingInShape:!1},n=e=>{Object.assign(t,e)},o=()=>Object.freeze({...t}),{enable:r,disable:a}=((e,t)=>{const{canvas:n,ctx:o,markInstance:r,markParams:a,markOptions:l}=e,{getState:c,setState:d}=t||{},{registerEvent:g,destroy:p}=T();let u=!1;const h_h=[0,0],f=[0,0],m=[0,0];let y,w=null;const v=e=>{if(0!==e.button)return;u=!0;const t=e;[h_h[0],h_h[1]]=me(n,[t.x,t.y]),[f[0],f[1]]=me(n,[t.offsetX,t.offsetY]);const o=c?.();o&&o.draw&&o.drag&&!o.canDrawingInShape&&nn({point:[t.offsetX,t.offsetY],markInstance:r})&&(u=!1)},x=e=>{if(!u)return;const t=e;[m[0],m[1]]=me(n,[t.x,t.y]);const i=r.getPageIndex(),s=r.getInternalPage(i),c=()=>{const e=m[0]-h_h[0],t=m[1]-h_h[1],n={left:f[0],top:f[1],width:e,height:t},o={...n,position:pe(n),type:"rect",strokeStyle:"red",angle:s?.angle,...y||{}};return e<0&&(o.left=f[0]+e,o.width=-e),t<0&&(o.top=f[1]+t,o.height=-t),o};if(w)w.updateOptions(c());else{const e=c();w=Je(n,o,e,{markParams:a,markOptions:l,markInstance:r,setup(e){e.setState({position:r.transformPositionByPageRect(e.options),index:i})}}),w?.events?.onDrawStart?.(w),r.setPageState(w,i)}w.setState({position:r.transformPositionByPageRect(w.options),index:i}),w?.events?.onDrawChange?.(w),r.render()},b=()=>{if(u=!1,Math.abs(m[0]-h_h[0])<3||Math.abs(m[1]-h_h[1])<3)return w?.events?.onDrawCancel?.(w),w&&w.destroy(),w=null,void r.render();w?.events?.onDrawComplete?.(w),w=null};let k;return{name:"DrawRect",enable:e=>{y=e,k=s(n),i(n,"crosshair",!0),g({el:n,event:"mousedown",callback:v}),g({el:window,event:"mousemove",callback:x}),g({el:window,event:"mouseup",callback:b})},disable:()=>{i(n,k,!0),p()}}})(e,{getState:o,setState:n}),{enable:l,disable:c}=((e,t)=>{const{canvas:n,markInstance:o,markParams:r}=e,{getState:a,setState:l}=t||{},{registerEvent:c,destroy:d}=T();let g=!1;const p=[0,0],u=[0,0];let h_h;const f=e=>{if(0!==e.button)return;g=!0;const t=e;[p[0],p[1]]=me(n,[t.offsetX,t.offsetY]),h_h=nn({point:[t.offsetX,t.offsetY],markInstance:o});const r=a?.();r&&r.draw&&r.drag&&r.canDrawingInShape&&h_h?g=!1:h_h&&(w=s(n),i(n,"move",!0))},m=e=>{if(!g||!h_h)return;const t=e,[o,r]=me(n,[t.offsetX,t.offsetY]);[u[0],u[1]]=[o-p[0],r-p[1]],h_h.move?.([u[0],u[1]]),[p[0],p[1]]=[o,r]},y=e=>{g=!1,h_h=void 0,i(n,w,!0)};let w;return{name:"DragShape",enable:()=>{c({el:n,event:"mousedown",callback:f}),c({el:window,event:"mousemove",callback:m}),c({el:window,event:"mouseup",callback:y})},disable:()=>{d()}}})(e,{getState:o,setState:n}),d=e=>{n({draw:!0}),r(e)},g=()=>{n({drag:!0}),l()},p=()=>{n({draw:!1,drag:!1}),a(),c()};return{name:"Draw",enable:e=>{d(e),g()},enableDraw:d,enableDrag:g,destroy:p,disable:p}},rn=e=>{let t=e.keyframes.map((e=>e.state.map((e=>e[0])))).flat(2);const n=an(t),o=[];for(const[t,r]of n)"rect"===t?e.handler=Ge:"polygon"!==t&&"badge"!==t||(e.handler=Ue),o.push(Xe(e));return{run:()=>{o.map((e=>e.run()))}}},an=e=>{const t=new Map;for(const n of e){const e=n.options.type;let o=t.get(e);o||t.set(e,o=[]),o.push(n)}return t},sn=(e,t)=>{if(!e?.length)return[];const n=new Map;e.map((e=>n.set(e,"rect"===e.options.type?Ke(e,t):qe(e,t))));const o=[],r=n.get(e[0])||[];for(let e=0;e<r.length;e++){const t={percent:.1,state:[]};for(const[o,r]of n)t.state.push([o,r[e]]);o.push(t)}return o},ln=(e,t,n)=>({duration:600,render:t,keyframes:sn(e,n)}),cn=(e,t)=>Number(e.toFixed(t));"undefined"!=typeof window&&import("./index-d165d94e.js");const dn=e=>{let n;const i=()=>{const t={markOptions:e,pages:[],getLocation:n?.getLocation,mode:e.mode||"default",width:0,height:0,backgroundColor:"",...e,backgroundImageBorder:e.backgroundImageBorder,enableCopyText:e.enableCopyText??!1,enableWorker:e.enableWorker??!0,margin:e.margin??20,padding:e.padding??20,gap:e.gap??20,modeOfMaxHeightOptions:e.modeOfMaxHeightOptions||{scrollTop:0},multiple:e.multiple??!0,preloadImageNum:e.preloadImageNum??3,minScale:e.minScale||.1,maxScale:e.maxScale||10,disableScroll:e.disableScroll??!1,disableZoom:e.disableZoom??!1,disableMove:e.disableMove??!1,scrollbarVerticalClassName:e.scrollbarVerticalClassName||"scroll-bar",scrollbarHorizontalClassName:e.scrollbarHorizontalClassName||"scroll-bar",plugins:[e.enableCopyText&&Zt,on,...e.plugins||[]].filter(Boolean),getMarkInstance:()=>$};return n?(Object.assign(n,t),W(n.mode,!1),n):t};let s,c;n=i();const d={all:g=g||new Map,on:function(e,t){var n=g.get(e);n?n.push(t):g.set(e,[t])},off:function(e,t){var n=g.get(e);n&&(t?n.splice(n.indexOf(t)>>>0,1):g.set(e,[]))},emit:function(e,t){var n=g.get(e);n&&n.slice().map((function(e){e(t)})),(n=g.get("*"))&&n.slice().map((function(n){n(e,t)}))}};var g;let p;const h_h=()=>{const t=o(e.selector);if(null==t)throw new Error("selector is not exist");return p=((e,t,n={throttle:100,enableFrame:!1})=>{let o=e;if("string"==typeof e&&(o=document.querySelector(e)),!o)return;const{throttle:r,debounce:a}=n,i=function(e,n){for(const n of e)t(n)};let s=i;n.enableFrame?s=(...e)=>{window.requestAnimationFrame((()=>i(...e)))}:null!=r?s=Rt(i,r,{leading:!0,trailing:!0}):null!=a&&(s=At(i,a,{leading:!0,trailing:!0}));const l=new ResizeObserver(s);return l.observe(o),function(){l.disconnect()}})(t,(()=>{n.width=e.width??t.offsetWidth,n.height=e.height??t.offsetHeight}),{enableFrame:!0}),n.width=e.width??t.offsetWidth,n.height=e.height??t.offsetHeight,t},f=()=>{const e=h_h();if(s?r(s,n.width,n.height):(s=(({width:e,height:t})=>{const n=document.createElement("canvas");return r(n,e,t),n})({width:n.width,height:n.height}),e.appendChild(s)),c=s.getContext("2d"),c.translate(x[0],x[1]),c.scale(S[0],S[1]),null==c)throw new Error("ctx is not exist")},m={left:0,top:0,right:0,bottom:0},y=()=>m,w=(t=!0)=>{m.left=0,m.top=0,m.right=0,m.bottom=0,t&&e.onContainerSizeChange?.(m,m),T?.resetContainerSize()},v=(t,n)=>{const[o,r]=le(s),a=t.left*o,i=t.right*o,l=t.top*r,c=t.bottom*r;m.left=0===m.left?Math.max(m.left,a):Math.min(m.left,a),m.top=0===m.top?Math.max(m.top,l):Math.min(m.top,l),m.right=Math.max(m.right,i),m.bottom=Math.max(m.bottom,c),e.onContainerSizeChange?.(m,fe(s,m)),n&&(T?.setVerticalRect(m,{isLast:n}),T?.setVerticalScroll(x))},x=[0,0],b=t=>{const n=x.slice();n[0]===t[0]&&n[1]===t[1]||(x[0]=t[0],x[1]=t[1],e.onTranslateChange?.(x,n),T?.setVerticalScroll(x))},k=e=>{b(e),O?.updateTranslate(e)},S=ce(),P=()=>S,M=t=>{const n=S.slice();cn(n[0],3)===cn(t[0],3)&&cn(n[1],3)===cn(t[1],3)||(S[0]=t[0],S[1]=t[1],e.onScaleChange?.(S,n))},I=e=>{M(e),O?.updateScale(S)},C=[],A=()=>{n.plugins?.length&&(R(),n.plugins.forEach(((t,o)=>{const r=t({canvas:s,ctx:c,markInstance:$,markOptions:e,markParams:n}),{init:a,destroy:i,name:l=t.name??`${o}`}=r;$.plugins[l]=r,a?.(),i&&C.push(i)})))},R=()=>{$.plugins={},C.forEach((e=>e())),C.length=0};let O;let T;let B;let E;const D=()=>{E=((e,{updateTranslate:n,getMin:o,getMax:r,render:i})=>{const s=async(t,o)=>{o??=se(e);const r=o[1],s=t[1],l=Math.abs(r-s)/10,c=r-s>0?1:-1;let d=r;const g=async()=>{if(c>0){if(d<=s)return}else if(d>=s)return;d+=l*-c,d=c>0?Math.max(d,s):Math.min(d,s),n([t[0],d]),i(),await a(g)};await a(g)};return{scrollIntoView:(a,i)=>{const[l,c]=se(e),[d,g]=le(e);i||={};let p=i.block||="nearest",u=0;const h_h=(i?.threshold??10)||0;let{top:f,height:m}=a;"nearest"===p&&(p=Math.floor((f-h_h)*g)<=-c?"start":Math.floor((f+m+h_h)*g-e.height)>=-c?"end":"center"),"start"===p?u=(f-h_h)*g:"center"===p?u=(f+m/2)*g-e.height/2:"end"===p&&(u=(f+m+h_h)*g-e.height);const y=t();u<o()*y&&(u=o()*y),u>r()*y&&(u=r()*y),"smooth"!==i.behavior?n([l,-u]):s([l,-u])},scrollBehaviorY:s}})(s,{getMin:()=>m?.top,getMax:()=>m?.bottom,render:Z,updateTranslate:k})},L=()=>{n.width=0,n.height=0,((t=!0)=>{const n=x.slice();x[0]=0,x[1]=0,t&&e.onTranslateChange?.(x,n)})(!1),((t=!0)=>{const n=S.slice(),o=ce();S[0]=o[0],S[1]=o[1],t&&e.onScaleChange?.(S,n)})(!1),w(!1)},{getMode:z,setMode:W}=(e=>({getMode:()=>e.mode,setMode:(t,n=!0)=>{const o=e.mode;switch(e.mode=t,t){case"max-width":e.getLocation=Te;break;case"max-height":e.getLocation=Oe;break;default:e.getLocation=Re}(n||t!==o)&&(e.markOptions?.onModeChange?.(t,o),e.getMarkInstance()?.emit("modeChange",[t,o]))}}))(n),j=()=>{const e=ce();k([0,0]),I(e),B?.genInternalPages(),Z()},Z=(e=!1)=>{(async(e,t,{waitPromise:o=!1}={})=>{if(!c)return;c.save(),(e=>{e.width=e.width})(s);const[r,a]=t,[i,l]=e;c.translate(i,l),c.scale(r,a),n.backgroundColor&&(c.fillStyle=n.backgroundColor,c.fillRect(-i/r,-l/a,s.width/r,s.height/a)),B?.drawPage(o),c.restore(),I(le(s)),k(se(s))})(x,S,{waitPromise:e})},$={...d,options:e,init:async({mode:t,translate:o,scale:r}={})=>{L(),f(),W(t??n.mode,!1),!E&&D(),!T&&(n.disableScroll||(T=be({canvas:s,markParams:n,containerSelector:e.selector,getMarkInstance:()=>$,onScroll:(e,t)=>{k(t),Z()}}))),T?.init(),!B&&(B=Et(s,c,{markOptions:e,markParams:n,markInstance:$,updateContainerRect:v,resetContainerRect:w,getLastScale:P,updateTranslate:k,render:Z,scrollIntoView:(...e)=>E?.scrollIntoView(...e),scrollBehaviorY:(...e)=>E?.scrollBehaviorY(...e)})),B?.init(),!O&&(O=Se(s,{markParams:n,markOptions:e,disableScroll:n.disableScroll,disableZoom:n.disableZoom,disableMove:n.disableMove,getTranslate:()=>x,getContainerRect:y,scrollBehaviorY:(...e)=>E?.scrollBehaviorY(...e),updateTranslate:b,updateScale:M,render:Z,onScroll:(t,n)=>e.onScroll?.(t,n),onDrag:(t,n)=>e.onDrag?.(t,n),zoomOptions:{getMin:()=>n.minScale,getMax:()=>n.maxScale},onZoom:()=>{B?.genInternalPages()}}),O?.init()),A(),Z(!0)},destroy:()=>{R(),O?.destroy(),B?.destroy(),T?.destroy(),s&&(s.parentElement||s.parentNode)?.removeChild(s),s=null,c=null,O=null,B=null,T=null,u.clear(),p?.()},reset:j,render:Z,rerender:()=>{const e=x,t=n.width;i(),f(),W(n.mode,!1);const o=n.width/t;k([e[0]*o,e[1]*o]),I(S),B?.init(),R(),A(),Z()},rotate:e=>(e=>{const{markParams:t,markInstance:n,index:o,angle:r=90,getPageIndex:a}=e,i=t.pages,s=a()??1;for(let e=0;e<i.length;e++){if(null!=o&&o-1!==e)continue;const t=n.getInternalPage(e+1);t&&(t.angle=l(t.angle+r))}n.genInternalPages(),n.changePage(s)})({markInstance:$,markParams:n,index:e,getPageIndex:()=>B?.getPageIndex()}),enableDrawShape:e=>{$.plugins.Draw?.enable(e)},cancelDrawShape:()=>{$.plugins.Draw?.disable()},getCanvas:()=>s,getContainerRect:()=>{const e=t();return{left:m.left*e,top:m.top*e,right:m.right*e,bottom:m.bottom*e}},getTranslate:()=>x,updateTranslate:k,getScale:P,updateScale:I,animate:(e,t)=>((e,t)=>{const{render:n}=e;let o;if("shapes"in e&&e.shapes)return o=ln(e.shapes,n,t),rn(o);return o={...e,render:n},Xe(o)})({...e,render:Z},t),setMode:e=>{const t=B?.getPageIndex();W(e),j(),t&&B?.changePage(t,!0)},setScaleByRadio:(e,t)=>{const{width:n,height:o}=s.getBoundingClientRect();t=t||[n/2,o/2],O?.setScaleByRadio(e,t)},removeRect:(...e)=>B?.removeRect(...e),removeShape:(...e)=>B?.removeShape(...e),removePageState:(...e)=>B?.removePageState(...e),drawRect:(...e)=>B?.drawRect(...e),drawPolygon:(...e)=>B?.drawPolygon(...e),drawBadge:(...e)=>B?.drawBadge(...e),getInternalPage:(...e)=>B?.getInternalPage(...e),getInternalPagesByVisible:(...e)=>B?.getInternalPagesByVisible(...e),genInternalPages:(...e)=>B?.genInternalPages(...e),changePage:(...e)=>B?.changePage(...e),getPageState:(...e)=>B?.getPageState(...e),setPageState:(...e)=>B?.setPageState(...e),queryState:(...e)=>B?.queryState(...e),queryAllState:(...e)=>B?.queryAllState(...e),getActive:(...e)=>B?.getActive(...e),setActive:(...e)=>B?.setActive(...e),getPageByPoint:(...e)=>B?.getPageByPoint(...e),getPageIndex:(...e)=>B?.getPageIndex(...e),addSelector:(...e)=>B?.addSelector(...e),removeSelector:(...e)=>B?.removeSelector(...e),scrollIntoView:(...e)=>B?.scrollIntoView(...e),transformPositionByPageRect:(...e)=>B?.transformPositionByPageRect(...e),transformPositionByPagePolygon:(...e)=>B?.transformPositionByPagePolygon(...e),getBoundingClientRect:()=>{const e=s.getBoundingClientRect(),n=t();return Object.assign(e,{actualWidth:e.width*n,actualHeight:e.height*n})},transformActualPoint:e=>ye(s,e),updatePages:t=>{t&&(e.pages=t,n.pages=t),B?.update(),Z()},updateOptions:t=>{e=Object.assign(e,t),i()},plugins:{}};return $};var gn;!function(e){e.RECT="rect",e.IMAGE="image"}(gn||(gn={}));const pn=(e,t={})=>{const n=document.createElementNS("http://www.w3.org/2000/svg",e);for(const e in t)n.setAttribute(e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`)),t[e]);return n},un=(e={})=>({stroke:"green",strokeWidth:"2",fill:"none",...e}),hn=(e=!1)=>e?1:-1,fn=()=>{let e=null;const t=(t={})=>{e=pn("svg",{class:"line-connector",width:"100%",height:"100%",style:"position: fixed; top: 0; left: 0; z-index: 9999; pointer-events: none;",...t})};return{createLine:(n,o,r={})=>{if(t(),!e)return;const a=pn("line",{x1:String(n.x),y1:String(n.y),x2:String(o.x),y2:String(o.y),...un(r)});e.appendChild(a),document.body.appendChild(e)},createArcLine:(n,o,r,a={})=>{const{baseX:i=(n.x+o.x)/2,radius:s=20}=r??{},l=Math.min(n.x,o.x),c=Math.max(n.x,o.x);if(i<l||i>c)return void console.warn("baseX is not in the range of anchor and target");if(t(),!e)return;const d=Math.min(Math.abs(n.y-o.y)/2,s),g=un(a),p=n.x-o.x<0,u=n.y-o.y<0,h_h=Number(p)^Number(u),f=i-d*hn(p),m=n.y+d*hn(u),y=i+d*hn(p),w=o.y-d*hn(u),v=pn("path",{d:`M ${n.x} ${n.y} L ${f} ${n.y}`,...g}),x=pn("path",{d:`M ${f} ${n.y} A ${d} ${d} 0 0 ${Number(!h_h)} ${i} ${m}`,...g}),b=pn("path",{d:`M ${i} ${m} L ${i} ${w}`,...g}),k=pn("path",{d:`M ${i} ${w} A ${d} ${d} 0 0 ${h_h} ${y} ${o.y}`,...g}),S=pn("path",{d:`M ${y} ${o.y} L ${o.x} ${o.y}`,...g});e.appendChild(v),e.appendChild(x),e.appendChild(b),e.appendChild(k),e.appendChild(S),document.body.appendChild(e)},destroy:()=>{e?.parentNode?.removeChild(e),e=null}}};export{gn as ShapeEnums,dn as createMark,fn as useConnector};
//# sourceMappingURL=index.js.map
